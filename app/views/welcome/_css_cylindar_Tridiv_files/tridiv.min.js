/*! tridiv - v0.1.1 - by Julian Garnier - Creative Commons Attribution-NonCommercial-NoDerivs 3.0 Unported License - 2013-10-31 */function FastClick(a){"use strict";var b,c=this;if(this.trackingClick=!1,this.trackingClickStart=0,this.targetElement=null,this.touchStartX=0,this.touchStartY=0,this.lastTouchIdentifier=0,this.layer=a,!a||!a.nodeType)throw new TypeError("Layer must be a document node");this.onClick=function(){return FastClick.prototype.onClick.apply(c,arguments)},this.onMouse=function(){return FastClick.prototype.onMouse.apply(c,arguments)},this.onTouchStart=function(){return FastClick.prototype.onTouchStart.apply(c,arguments)},this.onTouchEnd=function(){return FastClick.prototype.onTouchEnd.apply(c,arguments)},this.onTouchCancel=function(){return FastClick.prototype.onTouchCancel.apply(c,arguments)},FastClick.notNeeded()||(this.deviceIsAndroid&&(a.addEventListener("mouseover",this.onMouse,!0),a.addEventListener("mousedown",this.onMouse,!0),a.addEventListener("mouseup",this.onMouse,!0)),a.addEventListener("click",this.onClick,!0),a.addEventListener("touchstart",this.onTouchStart,!1),a.addEventListener("touchend",this.onTouchEnd,!1),a.addEventListener("touchcancel",this.onTouchCancel,!1),Event.prototype.stopImmediatePropagation||(a.removeEventListener=function(b,c,d){var e=Node.prototype.removeEventListener;"click"===b?e.call(a,b,c.hijacked||c,d):e.call(a,b,c,d)},a.addEventListener=function(b,c,d){var e=Node.prototype.addEventListener;"click"===b?e.call(a,b,c.hijacked||(c.hijacked=function(a){a.propagationStopped||c(a)}),d):e.call(a,b,c,d)}),"function"==typeof a.onclick&&(b=a.onclick,a.addEventListener("click",function(a){b(a)},!1),a.onclick=null))}function Vector(){}function Line(){}function Matrix(){}function checkTouch(){var a=document.createElement("div");return a.setAttribute("ontouchmove","return;"),"function"==typeof a.ontouchmove?!0:!1}function startLoading(){document.body.classList.add("loading")}function stopLoading(){document.body.classList.remove("loading")}function whichTransitionEvent(){var a,b=document.createElement("fakeelement"),c={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(a in c)if(void 0!==b.style[a])return c[a]}function updateInnerHTML(a,b){var c=a.cloneNode(!1);return c.innerHTML=b,a.parentNode.replaceChild(c,a),c}function removeNodes(a){for(var b=document.getElementsByClassName(a),c=b.length-1;c>=0;--c)b[c].parentElement.removeChild(b[c])}function removeClass(a){for(var b=document.getElementsByClassName(a),c=b.length-1;c>=0;--c)b[c].classList.remove(a)}function removeStyles(a){if(a.removeAttribute("style"),a.childNodes.length>0)for(var b in a.childNodes)1===a.childNodes[b].nodeType&&removeStyles(a.childNodes[b])}function getShape(a){for(var b in shapes)if(shapes[b].id===a)return shapes[b]}function getStyle(a,b){if(a.currentStyle)var c=a.currentStyle[b];else if(window.getComputedStyle){var c=document.defaultView.getComputedStyle(a,null).getPropertyValue(b),d=parseInt(c,10);return d}}function em(a){var b=a/gridUnit;return b}function snapping(a){if("off"===settings.snap)return a;var b=settings.match;return a>b/2?Math.ceil(a/b)*b:b/2>a?Math.floor(a/b)*b:0}function findParentNode(a,b){if(b instanceof HTMLElement){for(var c=b.parentNode,d=1;null!==c&&!c.classList.contains(a);)c=c.parentNode,d++;return c}}function translate3DToShape(a){a=a.toString();var b=/([0-9-.]+)+(?![3d]\()/gi,c=a.match(b);return{x:parseFloat(c[0]),y:parseFloat(c[1]),z:parseFloat(c[2])}}function updateList(a,b,c){for(var d="",e=0;e<b.length;e++)d+='<li><label class="list-label"><input data-bind-group="'+b[e].groupId+'" id="'+b[e].groupId+'" type="radio" class="radio-list '+c+'-list" value="'+b[e].name+'" name="group-item"/></label></li>';updateInnerHTML(a,d)}function selectElementContents(a){var b;if(window.getSelection&&document.createRange){b=document.createRange();var c=window.getSelection();b.selectNodeContents(a),c.removeAllRanges(),c.addRange(b)}else document.body&&document.body.createTextRange&&(b=document.body.createTextRange(),b.moveToElementText(a),b.select())}function rangeSettingsUpdate(a){("shade"===a||"tint"===a||"light"===a)&&updateLight(settings.light),"name"===a&&(console.log("name"),document.title=settings.name+" | Tridiv"),"zoom"===a&&updateZoom(),updateShapeToolsPosition(selection),updateDocumentCSS(),updateURL()}function rangeSelectionUpdate(a){"name"===a&&checkIfNameIsValid(selection),updateCSS(selection),updateURL(),updateShapeToolsPosition(selection),"edit"===selectedTool&&reverseCamera(context,selection.id,selection.x,selection.y,selection.z,selection.rx,selection.ry,selection.rz)}function DataBinder(a){var b={callbacks:{},on:function(a,b){this.callbacks[a]=this.callbacks[a]||[],this.callbacks[a].push(b)},publish:function(a){this.callbacks[a]=this.callbacks[a]||[];for(var b=0,c=this.callbacks[a].length;c>b;b++)this.callbacks[a][b].apply(this,arguments)}},c="data-bind-"+a,d=a+":change",e=function(a){var e=a.target,f=e.getAttribute(c);f&&""!==f&&b.publish(d,f,e.value)};return document.addEventListener("change",e,!1),b.on(d,function(a,b,d){for(var e,f=document.querySelectorAll("["+c+"="+b+"]"),g=0,h=f.length;h>g;g++)e=f[g].tagName.toLowerCase(),("input"===e||"div"===e||"img"===e)&&("input"===e||"div"===e?"radio"===f[g].type||"checkbox"===f[g].type?("radio"===f[g].type&&(f[g].checked=d===f[g].value?!0:!1),"checkbox"===f[g].type&&("on"===d?(f[g].checked=!0,f[g].value="off"):(f[g].checked=!1,f[g].value="on"))):f[g].value=d:("color-thumb"===f[g].classList[0]&&(f[g].style.backgroundColor=d),"image-thumb"===f[g].classList[0]&&(f[g].src=d)),f[g].parentNode.classList.add("active"),f[g].disabled=!1,null!==d&&d!==!1||"checkbox"===f[g].type||(f[g].parentNode.classList.remove("active"),f[g].disabled=!0))}),b}function Obj(a){var b=new DataBinder(a),c={attributes:{},set:function(c,d){this.attributes[c]=d,b.publish(a+":change",c,d,this)},get:function(a){return this.attributes[a]},_binder:b};return b.on(a+":change",function(a,b,d,e){e!==c&&(storeActions("update",selection),c.set(b,d),selection[b]=d,rangeChanging===!1&&rangeSelectionUpdate(b))}),c}function Settings(a){var b=new DataBinder(a),c={attributes:{},set:function(c,d){this.attributes[c]=d,b.publish(a+":change",c,d,this)},get:function(a){return this.attributes[a]},_binder:b};return b.on(a+":change",function(a,b,d,e){e!==c&&(c.set(b,d),settings[b]=d,rangeChanging===!1&&rangeSettingsUpdate(b))}),c}function removeVendors(a){return a.replace(/-(moz|webkit|ms|o)-/gm,"")}function cleanHTML(a){return a.replace(/(style=""| selected| id="scene3D"|\s*<div class="shapes-wrapper" style="">\s*|\s*<div class="shapes-wrapper">\s*|\s*<div class="shapes" style="">\s*|\s*<div class="shapes">\s*|\s*<div class="axis"><\/div>\s*|<\/div>\s*<\/div>\s*$)/g,"")}function postToUrl(a,b,c){c=c||"post";var d=document.createElement("form");d.setAttribute("method",c),d.setAttribute("action",a);for(var e in b)if(b.hasOwnProperty(e)){var f=document.createElement("input");f.setAttribute("type","hidden"),f.setAttribute("name",e),f.setAttribute("value",b[e]),d.appendChild(f)}document.body.appendChild(d),d.submit()}function getCode(){var a='<div id="tridiv">',b=document.getElementById("documentCSS").innerHTML,c=document.getElementById("baseCSS").innerHTML,d=document.getElementById("baseCuboidCSS").innerHTML,e=document.getElementById("baseCylinderCSS").innerHTML,f=document.getElementById("basePrismCSS").innerHTML,g=document.getElementById("basePyramidCSS").innerHTML,h=document.getElementById("view3D").getElementsByClassName("wrapper")[0];document.getElementById("htmlOutput"),document.getElementById("cssOutput");var i=head.getElementsByClassName("shape-styles"),j=a+h.innerHTML+"</div>",k=b+c,l=!1,m=!1,n=!1,o=!1;for(var p in shapes)"cuboid"!==shapes[p].type||l||(k+=d,l=!0),"cylinder"!==shapes[p].type||m||(k+=e,m=!0),"prism"!==shapes[p].type||n||(k+=f,n=!0),"pyramid"!==shapes[p].type||o||(k+=g,o=!0);for(var p=0;p<i.length;p++)k+=i[p].innerHTML;var q=cleanHTML(j),r=removeVendors(k),s=function(a){return a=a.replace(/[&]/g,"&amp;"),a=a.replace(/[<]/g,"&lt;"),a=a.replace(/[>]/g,"&gt;")},t="<iframe style='width:800px;height:600px' src='"+embedURL+"'></iframe>",u=html_beautify(q,{indent_size:2}),v="/* /!\\ You need to add vendor prefixes in order to render the CSS properly (or simply use http://leaverou.github.io/prefixfree/) /!\\ */ "+css_beautify(r,{indent_size:2,autosemicolon:!0});document.getElementById("embedCode").value=t,document.getElementById("htmlOutput").innerHTML=s(u),document.getElementById("cssOutput").innerHTML=v;var w={title:settings.name,description:"Built with http://tridiv.com",html:u,html_pre_processor:"none",css:v,css_pre_processor:"none",css_starter:"reset",css_prefix_free:"true"};document.getElementById("editOnCodePen").value=JSON.stringify(w)}function addShape(a){if("undefined"==typeof a)for(var b=document.querySelectorAll("[data-create]"),c=0;c<b.length;c++)b[c].addEventListener(press,function(){var a={},b=this.dataset.create,c=Models[b]();for(var d in c)c.hasOwnProperty(d)&&(a[d]=c[d]);createShape(a),storeActions("create",a),updateURL(),selectShape(a)});else a.type,createShape(a),storeActions("create",a),updateURL(),selectShape(a)}function randomizer(a){function b(a,b){return Math.round(Math.random()*(b-a)+a)}function c(){var a=["pyramid","pyramid","prism","prism","cylinder","cuboid"];return a[Math.floor(Math.random()*a.length)]}function d(){function a(a,b,c){return 0>c&&(c+=1),c>1&&(c-=1),1/6>c?a+6*(b-a)*c:.5>c?b:2/3>c?a+6*(b-a)*(2/3-c):a}var b,c,d,e=1*Math.random()+0,f=Math.random()*(.9-.8)+.8,g=Math.random()*(.75-.65)+.65;if(0==f)b=c=d=g;else{var h=.5>g?g*(1+f):g+f-g*f,i=2*g-h;b=a(i,h,e+1/3),c=a(i,h,e),d=a(i,h,e-1/3)}return"rgb("+Math.round(255*b)+","+Math.round(255*c)+","+Math.round(255*d)+")"}AppStatus.startLoading(),setTimeout(function(){for(var e=0;a>e;e++){var f=c(),g={};g.type=f,g.x=b(-60,60),g.y=b(-60,60),g.z=b(-60,60),g.h=b(3,14),g.rx=b(0,359),g.ry=b(0,359),g.rz=b(0,359),"cylinder"!==f||"pyramid"!==f?(g.w=b(3,14),g.d=b(3,14)):(g.diameter=b(2,14),"sides"===f&&(g.sides=b(12,18))),g.cAll=d(),addShape(g)}AppStatus.stopLoading()},250,!1)}function editShape(){for(var a=document.getElementsByClassName("tool-edit"),b=0;b<a.length;b++)a[b].addEventListener(press,editView,!1);for(var c=document.getElementsByClassName("tool-move"),b=0;b<c.length;b++)c[b].addEventListener(press,moveView,!1)}function quickRotateShape(a,b,c){storeActions("update",a),"right"===b&&("viewTop"===context.id&&(a.ry=parseFloat(a.ry)-c),"viewSide"===context.id&&(a.rx=parseFloat(a.rx)-c),"viewFront"===context.id&&(a.rz=parseFloat(a.rz)+c)),"left"===b&&("viewTop"===context.id&&(a.ry=parseFloat(a.ry)+c),"viewSide"===context.id&&(a.rx=parseFloat(a.rx)+c),"viewFront"===context.id&&(a.rz=parseFloat(a.rz)-c)),selectionBinder.set("rx",a.rx),selectionBinder.set("ry",a.ry),selectionBinder.set("rz",a.rz),updateShape(a),updateShapeToolsPosition(a)}function duplicateShape(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);b.x=a.x+1,b.y=a.y+1,b.z=a.z+1,addShape(b)}function togglePanes(a){function b(){for(var a=0;a<c.length;a++)c[a].classList.remove("active")}var c=document.getElementsByClassName("side-pane");if("undefined"==typeof a)for(var d=document.getElementsByClassName("toggle-pane"),e=0;e<d.length;e++)d[e].addEventListener(release,function(){b();var a=this.dataset.toggle;document.getElementsByClassName(a)[0].classList.add("active")});else b(),document.getElementsByClassName(a)[0].classList.add("active")}function toggleDropdown(){for(var a=document.getElementsByClassName("dropdown"),b=0;b<a.length;b++)a[b].addEventListener(press,function(a){a.stopPropagation()});app.addEventListener(press,function(){for(var b=0;b<a.length;b++)a[b].classList.remove("active"),a[b].getElementsByClassName("btn")[0].classList.remove("active")});for(var c=0;c<a.length;c++){var d=a[c].getElementsByClassName("btn")[0];d.addEventListener(release,function(){if(d.classList.contains("active"))for(var b=0;b<a.length;b++)a[b].classList.remove("active"),a[b].getElementsByClassName("btn")[0].classList.remove("active");else this.classList.add("active"),this.parentNode.classList.add("active")})}}function openModal(a){function b(a){var b=document.getElementsByClassName(a)[0];app.classList.add("overlay"),b.classList.add("active")}b(a)}function closeModals(){function a(){setTimeout(function(){app.classList.remove("overlay")},200);for(var a=0;a<c.length;a++)c[a].classList.remove("active")}for(var b=document.getElementsByClassName("close-modals"),c=document.getElementsByClassName("modal"),d=0;d<b.length;d++)b[d].addEventListener(release,function(){a()});a()}function updateListState(a,b){function c(){for(var a=0;a<f.length;a++){if(f[a].checked){e.disabled=!1;break}e.disabled=!0}}var d=document.getElementById(a),e=document.getElementById(b),f=d.getElementsByTagName("input");e.disabled=!0;for(var g=0;g<f.length;g++)f[g].addEventListener("change",c,!1)}function openDocumentDialog(){var a="",b=0;for(var c in localStorage){b++;var d="doc-"+b;a+='<li><label class="list-label"><input type="radio" class="radio-list doc" id="'+d+'" value="'+c+'" name="shape-item"/><button class="btn btn-small btn-danger btn-delete-document" onclick="deleteSelectedDocument();">Delete</button></label></li>'}document.getElementById("savedDocuments").innerHTML=a,updateListState("savedDocuments","loadSelectedDocument")}function loadSelectedDocument(){for(var a,b=document.getElementById("savedDocuments").getElementsByClassName("doc"),c=0;c<b.length;c++)if(b[c].checked){a=b[c].value;break}loadDocument(a)}function deleteSelectedDocument(){for(var a,b=document.getElementById("savedDocuments").getElementsByClassName("doc"),c=0;c<b.length;c++)if(b[c].checked){a=b[c].value;break}confirm("Are you sure you want to delete this document?")&&(localStorage.removeItem(a),openDocumentDialog())}function newDocument(){settings={name:"Untitled Document",light:"static",shade:".3",tint:".15",border:"0.4",bg:"transparent",snap:"off",match:.5,zoom:100},undo=[],redo=[],createdShapes=0,shapes=[],context=document.getElementById("viewTop"),selection="",removeNodes("shape-styles"),removeNodes("shape"),deselectShapes(),centerSceneViews(),updateDocumentSettings(),updateDocumentCSS(settings),updateURL(),closeModals()}function updateZoom(){for(var a=0;a<views.length;a++)views[a].style.fontSize=settingsBinder.get("zoom")+"%","edit"===selectedTool&&null!==selection&&reverseCamera(views[a],selection.id,selection.x,selection.y,selection.z,selection.rx,selection.ry,selection.rz);updateDocumentCSS(),centerSceneViews()}function zoomIn(){var a=parseFloat(settingsBinder.get("zoom"))+25;375>=a&&(settingsBinder.set("zoom",a),settings.zoom=a,updateZoom(),updateURL())}function zoomOut(){var a=parseFloat(settingsBinder.get("zoom"))-25;a>=25&&(settingsBinder.set("zoom",a),settings.zoom=a,updateZoom(),updateURL())}function updateDocumentSettings(){for(var a in settings)settings.hasOwnProperty(a)&&settingsBinder.set(a,settings[a]);document.title=settings.name+" | Tridiv",updateZoom()}function updateURL(){var a=shapes.map(function(a){var b={},c=a.type,d=Models[c]();for(var e in a)(a[e]||0===a[e])&&(b.type=c,a[e]!==d[e]&&"id"!==e&&(b[e]=a[e]));return b}),b={settings:settings,shapes:a},c="&doc="+JSON.stringify(b),d="index.html?"+btoa("view="+currentView+c);window.history.pushState(currentView+"-view",settingsBinder.get("name")+currentView,d);var e=document.location.href.split("/");e[e.length-1]="index.html?"+btoa("view=full"+c),embedURL=e.join("/");var f=document.getElementById("view3D").getElementsByClassName("shape").length,g=document.getElementById("view3D").getElementsByClassName("face").length,h=f+" shapes, "+g+" faces";document.getElementById("documentInfos").innerHTML=h,getCode()}function decodeURL(){var a=document.location.href.split("/"),b=a[a.length-1],c=b.split("?")[1];if("undefined"==typeof c)return document.location.href;try{a[a.length-1]="index.html?"+atob(c);var d=a.join("/");return d}catch(e){return document.location.href}}function getUrlParams(){var a={},b=decodeURL();return b.replace(/[?&]+([^=&]+)=([^&]*)/gi,function(b,c,d){a[c]=d}),a}function parseURL(){var a=getUrlParams().view,b=getUrlParams().doc;if(null!==b&&void 0!==b){for(var c=JSON.parse(decodeURIComponent(b)),d=c.settings,e=c.shapes,f=0;f<e.length;f++)createShape(e[f]);currentView=a,settings=d,updateDocumentSettings(),updateDocumentCSS()}"preview"===a&&editorSwitch("preview"),"full"===a&&editorSwitch("full"),"editor"===a&&editorSwitch("editor")}function shortenURL(){var a=yourls.connect("http://tridiv.com/d/yourls-api.php",{signature:"f1aedf2090"});a.shorten(window.location.href,function(a){document.getElementById("shortURL").value=a.shorturl,document.getElementById("shortURL").select()})}function storeActions(a,b){var c=JSON.stringify(b);if("create"===a)var d={actionType:"create",shape:c};if("update"===a)var d={actionType:"update",shape:c};if("delete"===a)var d={actionType:"delete",shape:c};redo.length>0&&(redo=[],btnRedo.disabled=!0),undo.push(d),btnUndo.disabled=!1}function saveDocument(){document.getElementsByClassName("settings-name")[0].blur;var a=document.getElementsByClassName("settings-name")[0].value;settings.name=a,settingsBinder.set("name",a);var b={settings:settings,shapes:shapes},c=JSON.stringify(b);localStorage.setItem(a,c),localStorage.getItem(a)&&localStorage.getItem(a)&&(document.getElementsByClassName("document-name")[0].classList.add("saved"),setTimeout(function(){document.getElementsByClassName("document-name")[0].classList.remove("saved")},2e3))}function loadDocument(a){AppStatus.startLoading(),setTimeout(function(){newDocument();for(var b=localStorage.getItem(a),c=JSON.parse(b),d=c.settings,e=c.shapes,f=0;f<e.length;f++)createShape(e[f]);settings=d,updateDocumentSettings(),updateDocumentCSS(),updateURL(),deselectShapes(),AppStatus.stopLoading(),updateLight("static"),closeModals()},350,!1)}function editorSwitch(a){function b(a){"width"===a.propertyName&&(setTimeout(updateLight,100,!1),this.removeEventListener(transitionEnd,b,!1))}function c(a){"width"===a.propertyName&&(setTimeout(centerSceneViews,100,!1),this.removeEventListener(transitionEnd,c,!1))}function d(a){("preview"===a||"full"===a)&&(app.classList.remove("editor-view"),app.classList.add("preview-view")),"full"===a&&(currentView="full",app.classList.add("full-view")),"preview"===a&&(currentView="preview",app.classList.remove("full-view"),togglePanes("pane-doc-props"),document.getElementsByClassName("switch-editor")[0].classList.remove("active"),document.getElementsByClassName("switch-preview")[0].classList.add("active")),"editor"===a&&(removeLight(),currentView="editor",app.classList.add("editor-view"),app.classList.remove("preview-view"),app.classList.remove("full-view"),document.getElementsByClassName("switch-editor")[0].classList.add("active"),document.getElementsByClassName("switch-preview")[0].classList.remove("active"),togglePanes("pane-main")),updateURL()}if("undefined"!=typeof a)document.getElementById("view3D").addEventListener(transitionEnd,b,!1),d(a);else{var e=document.getElementById("editorSwitch");e.addEventListener(release,function(){"preview"===currentView?(document.getElementById("view3D").addEventListener(transitionEnd,c,!1),d("editor")):(document.getElementById("view3D").addEventListener(transitionEnd,b,!1),d("preview"))})}}function updateDocumentCSS(){if("undefined"!=typeof settings){var a="";a+="#tridiv{",a+="perspective: 800px; position: absolute; overflow: hidden; width: 100%; height: 100%; background: ",a+=settings.bg+";",a+="font-size: ",a+=settings.zoom+"%;",a+="}","0"!==settings.border&&(a+=".face{box-shadow: inset 0 0 0 1px rgba(0, 0, 0, ",a+=settings.border+");",a+="}");var b=document.getElementById("documentCSS");updateInnerHTML(b,a),editor.style.background=settings.bg}}function defineCylinderSides(a,b,c){c=parseFloat(c);for(var d=a.getElementsByClassName(b),e=0;e<d.length;e++){var f=d[e].getElementsByClassName("side"),g=f.length;if(c>g)for(var h=g;c>h;h++){var i=document.createElement("div");i.setAttribute("class","face side s"+h),d[e].appendChild(i)}if(g>c)for(var h=g;h>c;h--)for(var j=d[e].getElementsByClassName("s"+(h-1)),k=j.length-1;k>=0;--k)j[k].parentElement.removeChild(j[k])}}function defineCorners(a,b){for(var b=parseFloat(b),c=document.getElementsByClassName(a),d=0;d<c.length;d++){var e=c[d].getElementsByClassName("cr");if(e.length<4)for(var f=0;4>f;f++){var g=document.createElement("div");g.setAttribute("class","cr cr-"+f),c[d].appendChild(g)}defineCylinderSides(c[d],"cr",b)}}function updateDOM(a){var b=document.createElement("style");b.type="text/css",b.id=a.id,b.classList.add("shape-styles"),b.classList.add("cssfx"),head.appendChild(b);for(var c=0;c<scenes.length;c++){var d=document.getElementById(a.type+"Sample").cloneNode(!0);d.addEventListener(press,pointerSelection,!1),"scene3D"!==scenes[c].id&&(d.addEventListener(press,grabTool,!1),d.addEventListener(move,moveTool,!1),d.addEventListener(release,dropTool,!1)),d.removeAttribute("id"),d.setAttribute("class","shape "+a.id+" "+a.name),scenes[c].getElementsByClassName("shapes")[0].appendChild(d)}}function checkIfNameIsValid(a){var b=a.name,c=document.getElementsByClassName(a.id),d=c[0].classList[2];if(b.match(/-?[_a-zA-Z]+[_a-zA-Z0-9-]*/g)){var e=b.match(/-?[_a-zA-Z]+[_a-zA-Z0-9-]*/g);if("undefined"==typeof document.getElementsByClassName(e)[0]){selectionBinder.set("name",e),a.name=e;for(var f=0;f<c.length;f++){var g=new RegExp("(?:^|\\s)"+d+"(?!\\S)","g");c[f].className=c[f].className.replace(g," "+e)}}else selectionBinder.set("name",d),a.name=d,document.getElementById("shapeClassName").classList.add("input-error"),setTimeout(function(){document.getElementById("shapeClassName").classList.remove("input-error")},1e3)}else selectionBinder.set("name",d),a.name=d,document.getElementById("shapeClassName").classList.add("input-error"),setTimeout(function(){document.getElementById("shapeClassName").classList.remove("input-error")},1e3)}function updateCSS(a){if("undefined"!=typeof a){var b="."+a.name,c=a.x,d=a.y,e=a.z,f=a.w,g=a.h,h=a.d,i=a.diameter,j=a.sides,k=a.o,l=a.cAll,m=a.cTp,n=a.cBm,o=a.cLt,p=a.cRt,q=a.cFt,r=a.cBk,s=a.cSe,t=a.iAll,u=a.iTp,v=a.iBm,w=a.iLt,x=a.iRt,y=a.iFt,z=a.iBk,A=a.iSe,B="";if(B+="/* "+b+" styles */",B+=b+"{",B+="transform:translate3D("+c+"em,"+d+"em,"+e+"em) rotateX("+a.rx+"deg) rotateY("+a.ry+"deg) rotateZ("+a.rz+"deg);",B+="opacity:"+k+";","cuboid"===a.type&&(B+="width:"+f+"em;",B+="height:"+g+"em;",B+="margin:"+-g/2+"em 0 0 "+-f/2+"em;",B+="}",B+=b+" .ft{transform:translateZ("+h/2+"em);}",B+=b+" .bk{transform:translateZ("+-h/2+"em) rotateY(180deg);}",B+=b+" .rt,",B+=b+" .lt{",B+="width:"+h+"em;",B+="height:"+g+"em;",B+="}",B+=b+" .tp,",B+=b+" .bm{",B+="width:"+f+"em;",B+="height:"+h+"em;",B+="}",B+=setTexture(b+" .face",t,l),B+=setTexture(b+" .ft",y,q),B+=setTexture(b+" .bk",z,r),B+=setTexture(b+" .tp",u,m),B+=setTexture(b+" .bm",v,n),B+=setTexture(b+" .lt",w,o),B+=setTexture(b+" .rt",x,p),0!==a.cr)){a.cr>f/2&&(a.cr=f/2),a.cr>h/2&&(a.cr=h/2);var C=cornerSides(a.cr);B+=b+" .ft{",B+="width:"+(f-2*a.cr)+"em;",B+="margin-left:"+a.cr+"em;",B+="}",B+=b+" .bk{",B+="width:"+(f-2*a.cr)+"em;",B+="margin-left:"+-a.cr+"em;",B+="}",B+=b+" .rt,",B+=b+" .lt{",B+="width:"+(h-2*a.cr)+"em;",B+="}",B+=b+" .tp,",B+=b+" .bm,",B+=b+" .tp .photon-shader,",B+=b+" .bm .photon-shader{",B+="border-radius:"+a.cr+"em;",B+="}",B+=b+" .cr{",B+="width:"+a.cr+"em;",B+="left:"+a.cr/2+"em;",B+="}",B+=b+" .cr-0{",B+="transform: translate3D("+(f-2*a.cr)+"em,0,"+(h-2*a.cr)/2+"em);",B+="}",B+=b+" .cr-1{",B+="transform: translate3D("+(f-2*a.cr)+"em,0,"+-(h-2*a.cr)/2+"em);",B+="}",B+=b+" .cr-2{",B+="transform: translate3D(0,0,"+-(h-2*a.cr)/2+"em);",B+="}",B+=b+" .cr-3{",B+="transform: translate3D(0,0,"+(h-2*a.cr)/2+"em);",B+="}",B+=sidesStyles(b+" .cr-0",C,2*a.cr,90,0),B+=sidesStyles(b+" .cr-1",C,2*a.cr,90,90),B+=sidesStyles(b+" .cr-2",C,2*a.cr,90,180),B+=sidesStyles(b+" .cr-3",C,2*a.cr,90,270),B+=b+" .side{",B+="width:"+calculateSidesWidth(a.cr,C,90)+"em;",B+="}",defineCorners(a.id,C,a.cr)}if("cylinder"===a.type&&(B+="width:"+i+"em;",B+="height:"+g+"em;",B+="margin:"+-g/2+"em 0 0 "+-i/2+"em;",B+="}",B+=b+" .tp,",B+=b+" .bm{",B+="width:"+i+"em;",B+="height:"+i+"em;",B+="}",B+=b+" .side{",B+="width:"+calculateSidesWidth(i/2,j)+"em;",B+="height:"+g+"em;",B+="}",B+=sidesStyles(b,j,i),B+=setTexture(b+" .face, "+b+" .side",t,l),B+=setTexture(b+" .tp",u,m),B+=setTexture(b+" .bm",v,n),B+=setTexture(b+" .side",A,s),defineCylinderSides(document,a.id,j)),"prism"===a.type){var D=pythagoras(h,g),E=prismAngle(D,g);B+="width:"+f+"em;",B+="height:"+g+"em;",B+="margin:"+-g/2+"em 0 0 "+-f/2+"em;",B+="}",B+=b+" .rt .face{",B+="transform:rotateZ("+-E+"deg);",B+="}",B+=b+" .lt .face{",B+="transform:rotateZ("+E+"deg);",B+="}",B+=b+" .ft{",B+="height:"+D+"em;",B+="transform:translateZ("+-h/2+"em) rotateX("+E+"deg);",B+="}",B+=b+" .bk{transform:translateZ("+-h/2+"em) rotateY(180deg);}",B+=b+" .rt,",B+=b+" .lt{",B+="width:"+h+"em;",B+="height:"+g+"em;",B+="}",B+=b+" .rt .face,",B+=b+" .lt .face{",B+="height:"+D+"em;",B+="}",B+=b+" .bm{",B+="width:"+f+"em;",B+="height:"+h+"em;",B+="}",B+=setTexture(b+" .face",t,l),B+=setTexture(b+" .ft",y,q),B+=setTexture(b+" .bk",z,r),B+=setTexture(b+" .bm",v,n),B+=setTexture(b+" .lt > div",w,o),B+=setTexture(b+" .rt > div",x,p)}if("pyramid"===a.type){var D=pythagoras(i/2,g),E=prismAngle(D,g),F=D/(i/2);B+="width:"+i+"em;",B+="height:"+g+"em;",B+="margin:"+-g/2+"em 0 0 "+-i/2+"em;",B+="}",B+=b+" .face-wrapper{",B+="width:"+i+"em;",B+="height:"+i/2+"em;",B+="}",B+=b+" .face-wrapper .face{",B+="width:"+i+"em;",B+="height:"+i+"em;",B+="}",B+=b+" .ft{",B+="transform:scaleZ("+F+") scaleY("+F+") rotateX("+E+"deg);",B+="}",B+=b+" .bk{",B+="transform:scaleZ("+F+") scaleY("+F+") rotateX(-"+E+"deg) rotateY(180deg);",B+="}",B+=b+" .rt{",B+="transform:scaleX("+F+") scaleY("+F+") rotateZ("+E+"deg) rotateY(-90deg);",B+="}",B+=b+" .lt{",B+="transform:scaleX("+F+") scaleY("+F+") rotateZ(-"+E+"deg) rotateY(90deg);",B+="}",B+=b+" .bm{",B+="width:"+i+"em;",B+="height:"+i+"em;",B+="}",B+=setTexture(b+" .face",t,l),B+=setTexture(b+" .ft > div",y,q),B+=setTexture(b+" .bk > div",z,r),B+=setTexture(b+" .bm",v,n),B+=setTexture(b+" .lt > div",w,o),B+=setTexture(b+" .rt > div",x,p)}var G=document.getElementById(a.id);updateInnerHTML(G,B)}}function addSuffix(a){var a=a.toString(),b=1,c=a.split("-").pop();c.toString().match("[0-9]+")&&(a=a.substring(0,a.length-(c.length+1)),b=parseFloat(c)+1);for(var d=a+"-"+b;"undefined"!=typeof document.getElementsByClassName(d)[0];)b++,d=a+"-"+b;return d}function createShape(a){createdShapes++;var b=a.type,c=Models[b]();for(var d in c)a[d]||(a[d]=c[d]);"undefined"==typeof a.id&&(a.id=addSuffix(a.type));for(var d in shapes)shapes[d].id===a.id&&(a.id=addSuffix(a.id));"undefined"==typeof a.name&&(a.name=addSuffix(a.type.substring(0,3)));for(var d in shapes)shapes[d].name===a.name&&(a.name=addSuffix(a.name));shapes.push(a),updateDOM(a),updateCSS(a)}function updateShape(a){var b=getShape(a.id);for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);updateCSS(a),updateURL()}function deleteShape(a){var b=a.id;for(var c in shapes)if(shapes[c].id===b){shapes.splice(c,1);break}removeNodes(b);var d=document.getElementById(b);d.parentElement.removeChild(d),removeNodes("shape-tools"),deselectShapes(),updateURL()}function updateLight(a){if("none"===a)removeLight();else if("editor"!==currentView){var b=document.getElementById("view3D").getElementsByClassName("face").length;b>99&&"dynamic"===settings.light?(document.getElementById("facesCount").innerHTML=b,openModal("lighting-warning")):("dynamic"===settings.light||"static"===settings.light)&&(AppStatus.startLightProcessing(),setTimeout(setupLight,100,!1))}}function removeLight(){lightShapes=[],removeNodes("photon-shader")}function setupLight(){removeLight();for(var a=parseFloat(settings.shade),b=parseFloat(settings.tint),c=scene3D.getElementsByClassName("shape"),d=0;d<c.length;d++){var e=[].slice.call(c[d].getElementsByClassName("face")),f=new Photon.FaceGroup(c[d],e,a,b,!1,scene3D);lightShapes.push(f)}renderLight()}function renderLight(){var a=parseFloat(settings.shade),b=parseFloat(settings.tint);setTimeout(function(){for(var c=0;c<lightShapes.length;c++)lightShapes[c].setMaxShade(a),lightShapes[c].setMaxTint(b),lightShapes[c].render(light,!0,!0);AppStatus.stopLightProcessing(),getCode()},100,!1)}function camera(a,b,c,d){function e(a){if(!mouseDown){mouseDown=!0;var b=i.style[PrefixFree.Prefix+"Transform"];n=a.pageX-l/2-j,o=a.pageY-m/2-k,p=translate3DToShape(b).y,q=translate3DToShape(b).x}}function f(a){if(mouseDown){pauseEvent(a),a.preventDefault();var b=a.pageX-l/2-j,c=a.pageY-m/2-k,d=b-n,e=c-o,f=p+d,g=q-e,h="transform:rotateX("+g+"deg) rotateY("+f+"deg); ",r="-webkit-"+h+"-moz-"+h+"-ms-"+h+h;i.setAttribute("style",r),"dynamic"===settings.light&&renderLight()}}function g(){mouseDown&&(getCode(),mouseDown=!1)}var h=document.getElementById(a),i=document.getElementById(b),j=h.offsetLeft,k=h.offsetTop,l=h.offsetWidth,m=h.offsetHeight,n=0,o=0,p=0,q=0,r="transform:rotateX("+c+"deg) rotateY("+d+"deg); ",s="-webkit-"+r+"-moz-"+r+"-ms-"+r+r;i.setAttribute("style",s),h.addEventListener(press,e,!1),h.addEventListener(move,f,!1),h.addEventListener(release,g,!1)}function centerSceneViews(){for(var a=0;a<scenes.length;a++)if("view3D"!==views[a].id){({left:views[a].scrollLeft,top:views[a].scrollTop});var b={left:scenes[a].offsetWidth/2-views[a].offsetWidth/2,top:scenes[a].offsetHeight/2-views[a].offsetHeight/2};if("undefined"!=typeof selection){var c=translateCoordinates(views[a].id,selectionBinder.get("x"),selectionBinder.get("y"),selectionBinder.get("z")),d={x:c.x*gridUnit*(settings.zoom/100),y:c.y*gridUnit*(settings.zoom/100)};views[a].scrollLeft=b.left+d.x,views[a].scrollTop=b.top+d.y}else views[a].scrollLeft=b.left,views[a].scrollTop=b.top}}function translateCoordinates(a,b,c,d){var e,f,g;"viewTop"===a&&(e=b,f=d,g=c),"viewSide"===a&&(e=d,f=c,g=b),"viewFront"===a&&(e=b,f=c,g=d);var h={x:e,y:f,z:g};return h}function translateHandlesRotation(a,b,c,d){var e,f,g;"viewTop"===a&&(e=0,f=c,g=0),"viewSide"===a&&(e=b,f=0,g=0),"viewFront"===a&&(e=0,f=0,g=d);var h={x:e,y:f,z:g};return h}function transformMatrix(a,b,c,d,e,f,g,h){var i=window.getComputedStyle(a).webkitTransform,j=new WebKitCSSMatrix(i),j=j.translate(b,c,d),j=j.rotate(e,f,g);if(h===!0)var j=j.inverse();return j}function translateSceneRotation(a,b,c,d,e,f,g,h){var i;return"viewTop"===a&&(i=transformMatrix(b,c*gridUnit,d*gridUnit,e*gridUnit,0,g,0,!0)),"viewSide"===a&&(i=transformMatrix(b,c*gridUnit,d*gridUnit,e*gridUnit,f,0,0,!0)),"viewFront"===a&&(i=transformMatrix(b,c*gridUnit,d*gridUnit,e*gridUnit,0,0,h,!0)),i}function reverseCamera(a,b,c,d,e,f,g,h){var c=c/(gridUnit/16),d=d/(gridUnit/16),e=e/(gridUnit/16);"view3D"!==a.id&&void 0!==window.WebKitCSSMatrix&&(a.getElementsByClassName("shapes")[0].style[PrefixFree.Prefix+"Transform"]=translateSceneRotation(a.id,document.getElementsByClassName(b)[0],0,0,0,-f,-g,-h),a.getElementsByClassName("shapes-wrapper")[0].style[PrefixFree.Prefix+"Transform"]="translate3D("+c+"em,"+d+"em,"+e+"em)")}function revertCamera(a){a.getElementsByClassName("shapes")[0].style[PrefixFree.Prefix+"Transform"]="",a.getElementsByClassName("shapes-wrapper")[0].style[PrefixFree.Prefix+"Transform"]=""}function rotatePoints(a,b,c){var d={};return d.x=Math.cos(c/180*Math.PI)*a-Math.sin(c/180*Math.PI)*b,d.y=Math.sin(c/180*Math.PI)*a+Math.cos(c/180*Math.PI)*b,d}function deselectShapes(){selection=null;for(var a=document.querySelectorAll("[data-bind-selection]"),b=0,c=a.length;c>b;b++){var d=a[b].dataset.bindSelection;selectionBinder.set(d,null)}for(var b=0,c=actionBtns.length;c>b;b++)actionBtns[b].disabled=!0;removeClass("selected"),removeNodes("shape-tools")}function selectShape(a){deselectShapes(),selection=a;var b=a.id;for(var c in selection)selection.hasOwnProperty(c)&&selectionBinder.set(c,selection[c]);for(var d=document.getElementsByClassName(b),e=0;e<views.length;e++)revertCamera(views[e]);for(var e=0;e<d.length;e++)d[e].classList.add("selected");for(var e=0,f=actionBtns.length;f>e;e++)actionBtns[e].disabled=!1;
showShapeTools(a)}function pointerSelection(a){a.preventDefault();var b=findParentNode("shape",a.target);obj=getShape(b.classList[1]),context=findParentNode("view",a.target),selectShape(obj),editor.setAttribute("class",context.id),"move"!==selectedTool&&reverseCamera(context,selection.id,selection.x,selection.y,selection.z,selection.rx,selection.ry,selection.rz)}function moveView(){app.classList.add("move-tool"),app.classList.remove("edit-tool"),selectedTool="move",document.getElementById("btnMove").checked=!0;for(var a=0;a<views.length;a++)revertCamera(views[a]);for(var b=document.getElementsByClassName("shape-tools"),a=0;a<b.length;a++)b[a].classList.add("hide-handles")}function editView(){app.classList.add("edit-tool"),app.classList.remove("move-tool"),selectedTool="edit",document.getElementById("btnEdit").checked=!0;for(var a=0;a<views.length;a++)reverseCamera(views[a],selection.id,selection.x,selection.y,selection.z,selection.rx,selection.ry,selection.rz);for(var b=document.getElementsByClassName("shape-tools"),a=0;a<b.length;a++)b[a].classList.remove("hide-handles")}function pauseEvent(a){return a.stopPropagation&&a.stopPropagation(),a.preventDefault&&a.preventDefault(),a.cancelBubble=!0,a.returnValue=!1,!1}function showShapeTools(a){removeNodes("shape-tools");for(var b=document.getElementsByClassName(a.id),c=0;c<b.length;c++){var d=findParentNode("view",b[c]),e=document.getElementById("shapeTools").cloneNode(!0),f=e.getElementsByClassName("handles-wrapper")[0];if("cylinder"===a.type||"pyramid"===a.type)var g=translateCoordinates(d.id,a.diameter,a.h,a.diameter);else var g=translateCoordinates(d.id,a.w,a.h,a.d);var h=translateHandlesRotation(d.id,a.rx,a.ry,a.rz);e.removeAttribute("id"),e.classList.add("shape-tools"),e.style[PrefixFree.Prefix+"Transform"]="translate3D("+a.x+"em,"+a.y+"em,"+a.z+"em)",f.style[PrefixFree.Prefix+"Transform"]="rotateX("+h.x+"deg) rotateY("+h.y+"deg) rotateZ("+h.z+"deg)",f.style.width=g.x+"em",f.style.height=g.y+"em",f.style.marginLeft=g.x/-2+"em",f.style.marginTop=g.y/-2+"em";for(var i=e.getElementsByClassName("handle"),j=0;j<i.length;j++)i[j].addEventListener(press,grabTool,!1),i[j].addEventListener(move,moveTool,!1);for(var k=e.getElementsByClassName("btn-handle"),j=0;j<k.length;j++)k[j].addEventListener(press,function(b){b.stopPropagation(),context=findParentNode("view",b.target),editor.setAttribute("class",context.id);var c=this.dataset.edit;"move"===c&&moveView(),"edit"===c&&editView(),"delete"===c&&(storeActions("delete",a),deleteShape(a)),"duplicate"===c&&duplicateShape(a),"rotate-90-rt"===c&&quickRotateShape(a,"right",90),"rotate-90-lt"===c&&quickRotateShape(a,"left",90)});"edit"!==selectedTool?editView():moveView(),"view3D"!==d.id&&findParentNode("scene",b[c]).appendChild(e)}editor.setAttribute("class",context.id);var l=document.getElementsByClassName("shape-tools");setTimeout(function(){for(var a=0;a<l.length;a++)l[a].classList.add("active")},1)}function updateShapeToolsPosition(a){if("undefined"!=typeof a)for(var b=document.getElementsByClassName("shape-tools"),c=0;c<b.length;c++){var d=b[c].getElementsByClassName("handles-wrapper")[0],e=findParentNode("view",b[c]),f=translateCoordinates(e.id,a.w,a.h,a.d),g=translateHandlesRotation(e.id,a.rx,a.ry,a.rz);b[c].style[PrefixFree.Prefix+"Transform"]="translate3D("+a.x+"em,"+a.y+"em,"+a.z+"em)",d.style[PrefixFree.Prefix+"Transform"]="rotateX("+g.x+"deg) rotateY("+g.y+"deg) rotateZ("+g.z+"deg)",d.style.width=f.x+"em",d.style.height=f.y+"em",d.style.marginLeft=f.x/-2+"em",d.style.marginTop=f.y/-2+"em"}}function grabTool(a){mouseDown||null===selection||(pauseEvent(a),mouseDown=!0,handle=a.target.classList[1],contextName=findParentNode("view",a.target),context=document.getElementById(contextName.id),handlesR=context.getElementsByClassName("handles-wrapper")[0],grabH={x:(a.pageX+context.scrollLeft-context.offsetLeft-context.getElementsByClassName("wrapper")[0].offsetWidth/2)/(settings.zoom/100),y:(a.pageY+context.scrollTop-context.offsetTop-context.getElementsByClassName("wrapper")[0].offsetHeight/2)/(settings.zoom/100)},grabO={x:selection.x,y:selection.y,z:selection.z,w:selection.w,h:selection.h,d:selection.d,diameter:selection.diameter,rx:selection.rx,ry:selection.ry,rz:selection.rz},grabR={w:em(getStyle(handlesR,"width")),h:em(getStyle(handlesR,"height"))},editor.setAttribute("class",context.id))}function moveTool(a){if(mouseDown&&null!==selection){mouseMoved=!0,pauseEvent(a);var b={x:(a.pageX+context.scrollLeft-context.offsetLeft-context.getElementsByClassName("wrapper")[0].offsetWidth/2)/(settings.zoom/100),y:(a.pageY+context.scrollTop-context.offsetTop-context.getElementsByClassName("wrapper")[0].offsetHeight/2)/(settings.zoom/100)},c=translateCoordinates(context.id,selection.rx,selection.ry,-selection.rz),d=rotatePoints(grabH.x-b.x,grabH.y-b.y,c.z),e={x:d.x,y:d.y},f={x:grabH.x-b.x,y:grabH.y-b.y};"move"===handle?moveShape(f):("circle"===handle&&rotateShape(b.x,b.y),"square"===handle&&resizeShape(a,e))}}function moveShape(a){var b=translateCoordinates(context.id,a.x,a.y,0);updatedPos={x:snapping(grabO.x-em(b.x)),y:snapping(grabO.y-em(b.y)),z:snapping(selection.z-em(b.z))};for(var c=document.getElementsByClassName(selection.id),d=0;d<c.length;d++)c[d].style[PrefixFree.Prefix+"Transform"]="translate3D("+updatedPos.x+"em,"+updatedPos.y+"em,"+updatedPos.z+"em) rotateX("+selection.rx+"deg) rotateY("+selection.ry+"deg) rotateZ("+selection.rz+"deg)";selectionBinder.set("x",updatedPos.x),selectionBinder.set("y",updatedPos.y),selectionBinder.set("z",updatedPos.z);var e=context.getElementsByClassName("shape-tools")[0];e.classList.add("dragged");for(var f=document.getElementsByClassName("shape-tools"),d=0;d<f.length;d++){var g=findParentNode("view",f[d]),h=translateHandlesRotation(g.id,selection.rx,selection.ry,selection.rz);f[d].style[PrefixFree.Prefix+"Transform"]="translate3D("+updatedPos.x+"em,"+updatedPos.y+"em,"+updatedPos.z+"em)",f[d].getElementsByClassName("handles-wrapper")[0].style[PrefixFree.Prefix+"Transform"]="rotateX("+h.x+"deg) rotateY("+h.y+"deg) rotateZ("+h.z+"deg)"}}function rotateShape(a,b){var c=translateCoordinates(context.id,selection.x,selection.y,selection.z),d=translateCoordinates(context.id,selection.rx,selection.ry,-selection.rz),e={x:c.x*gridUnit,y:c.y*gridUnit},f={x:a,y:b},g=Math.atan2(grabH.y-e.y,grabH.x-e.x),h=Math.atan2(f.y-e.y,f.x-e.x),i=d.z-180*(h-g)/Math.PI,j=translateCoordinates(context.id,d.x,d.y,i);updatedRot={rx:Math.round(10*j.x)/10,ry:Math.round(10*j.y)/10,rz:Math.round(10*-j.z)/10};for(var k=document.getElementsByClassName(selection.id),l=0;l<k.length;l++)k[l].style[PrefixFree.Prefix+"Transform"]="translate3D("+selection.x+"em,"+selection.y+"em,"+selection.z+"em) rotateX("+updatedRot.rx+"deg) rotateY("+updatedRot.ry+"deg) rotateZ("+updatedRot.rz+"deg)";selectionBinder.set("rx",updatedRot.rx),selectionBinder.set("ry",updatedRot.ry),selectionBinder.set("rz",updatedRot.rz);for(var m=document.getElementsByClassName("shape-tools"),l=0;l<m.length;l++){var n=findParentNode("view",m[l]),o=translateHandlesRotation(n.id,updatedRot.rx,updatedRot.ry,updatedRot.rz);m[l].style[PrefixFree.Prefix+"Transform"]="translate3D("+selection.x+"em,"+selection.y+"em,"+selection.z+"em)",m[l].getElementsByClassName("handles-wrapper")[0].style[PrefixFree.Prefix+"Transform"]="rotateX("+o.x+"deg) rotateY("+o.y+"deg) rotateZ("+o.z+"deg)"}context.getElementsByClassName("scene")[0].classList.add("stop-transition"),reverseCamera(context,selection.id,selection.x,selection.y,selection.z,updatedRot.rx,updatedRot.ry,updatedRot.rz)}function resizeShape(a,b){var c=a.target.classList[2],d=translateCoordinates(context.id,2*b.x,2*b.y,0);snapping(grabR.w-em(b.x)),snapping(grabR.h+em(b.y)),"n"===c&&(d=translateCoordinates(context.id,0,2*-b.y,0)),"ne"===c&&(d=translateCoordinates(context.id,2*b.x,2*-b.y,0)),"e"===c&&(d=translateCoordinates(context.id,2*b.x,0,0)),"se"===c&&(d=translateCoordinates(context.id,2*b.x,2*b.y,0)),"s"===c&&(d=translateCoordinates(context.id,0,2*b.y,0)),"sw"===c&&(d=translateCoordinates(context.id,2*-b.x,2*b.y,0)),"w"===c&&(d=translateCoordinates(context.id,2*-b.x,0,0)),"nw"===c&&(d=translateCoordinates(context.id,2*-b.x,2*-b.y,0));var e=document.getElementsByClassName(selection.id);if("cuboid"===selection.type||"prism"===selection.type){var f=snapping(grabO.w-em(d.x)),g=snapping(grabO.h-em(d.y)),h=snapping(selection.d-em(d.z));if(0>=f&&(f=0),0>=g&&(g=0),0>=h&&(h=0),updatedDim={w:f,h:g,d:h},"cuboid"===selection.type)for(var i=0;i<e.length;i++)if(e[i].style.width=updatedDim.w+"em",e[i].style.height=updatedDim.h+"em",e[i].style.margin=-updatedDim.h/2+"em 0 0 "+-updatedDim.w/2+"em",e[i].getElementsByClassName("ft")[0].style[PrefixFree.Prefix+"Transform"]="translateZ("+updatedDim.d/2+"em)",e[i].getElementsByClassName("bk")[0].style[PrefixFree.Prefix+"Transform"]="translateZ("+-updatedDim.d/2+"em) rotateY(180deg)",e[i].getElementsByClassName("rt")[0].style.width=updatedDim.d+"em",e[i].getElementsByClassName("rt")[0].style.height=updatedDim.h+"em",e[i].getElementsByClassName("lt")[0].style.width=updatedDim.d+"em",e[i].getElementsByClassName("lt")[0].style.height=updatedDim.h+"em",e[i].getElementsByClassName("tp")[0].style.width=updatedDim.w+"em",e[i].getElementsByClassName("tp")[0].style.height=updatedDim.d+"em",e[i].getElementsByClassName("bm")[0].style.width=updatedDim.w+"em",e[i].getElementsByClassName("bm")[0].style.height=updatedDim.d+"em",0!==selection.cr){var j=selection.cr,k=updatedDim.w-2*j,l=updatedDim.d-2*j;cornerSides(j),e[i].getElementsByClassName("ft")[0].style.marginLeft=j+"em",e[i].getElementsByClassName("bk")[0].style.marginLeft=-j+"em",updatedDim.w/2<selection.cr&&(k=0,e[i].getElementsByClassName("ft")[0].style.marginLeft=updatedDim.w/2+"em",e[i].getElementsByClassName("bk")[0].style.marginLeft=-updatedDim.w/2+"em"),updatedDim.d/2<selection.cr&&(l=0),e[i].getElementsByClassName("ft")[0].style.width=k+"em",e[i].getElementsByClassName("bk")[0].style.width=k+"em",e[i].getElementsByClassName("rt")[0].style.width=l+"em",e[i].getElementsByClassName("lt")[0].style.width=l+"em",e[i].getElementsByClassName("cr")[0].style.width=j+"em",e[i].getElementsByClassName("cr")[0].style.left=j/2+"em",e[i].getElementsByClassName("cr-0")[0].style[PrefixFree.Prefix+"Transform"]="translate3D("+k+"em,0,"+l/2+"em)",e[i].getElementsByClassName("cr-1")[0].style[PrefixFree.Prefix+"Transform"]="translate3D("+k+"em,0,"+-l/2+"em)",e[i].getElementsByClassName("cr-2")[0].style[PrefixFree.Prefix+"Transform"]="translate3D(0,0,"+-l/2+"em)",e[i].getElementsByClassName("cr-3")[0].style[PrefixFree.Prefix+"Transform"]="translate3D(0,0,"+l/2+"em)";for(var m=e[i].getElementsByClassName("cr"),n=0;n<m.length;n++)(selection.cr>updatedDim.w/2||updatedDim.w/2<selection.cr)&&(m[n].style.display="none"),(selection.cr>updatedDim.d/2||updatedDim.d/2<selection.cr)&&(m[n].style.display="none")}if("prism"===selection.type)for(var o=pythagoras(updatedDim.d,updatedDim.h),p=prismAngle(o,updatedDim.h),i=0;i<e.length;i++)e[i].style.width=updatedDim.w+"em",e[i].style.height=updatedDim.h+"em",e[i].style.margin=-updatedDim.h/2+"em 0 0 "+-updatedDim.w/2+"em",e[i].getElementsByClassName("face-wrapper")[0].getElementsByClassName("face")[0].style[PrefixFree.Prefix+"Transform"]="rotateZ("+-p+"deg)",e[i].getElementsByClassName("face-wrapper")[1].getElementsByClassName("face")[0].style[PrefixFree.Prefix+"Transform"]="rotateZ("+p+"deg)",e[i].getElementsByClassName("ft")[0].style.height=o+"em",e[i].getElementsByClassName("ft")[0].style[PrefixFree.Prefix+"Transform"]="translateZ("+-updatedDim.d/2+"em) rotateX("+p+"deg)",e[i].getElementsByClassName("bk")[0].style[PrefixFree.Prefix+"Transform"]="translateZ("+-updatedDim.d/2+"em)  rotateY(180deg)",e[i].getElementsByClassName("rt")[0].style.width=updatedDim.d+"em",e[i].getElementsByClassName("rt")[0].style.height=updatedDim.h+"em",e[i].getElementsByClassName("lt")[0].style.width=updatedDim.d+"em",e[i].getElementsByClassName("lt")[0].style.height=updatedDim.h+"em",e[i].getElementsByClassName("rt")[0].getElementsByClassName("face")[0].style.height=o+"em",e[i].getElementsByClassName("lt")[0].getElementsByClassName("face")[0].style.height=o+"em",e[i].getElementsByClassName("bm")[0].style.width=updatedDim.w+"em",e[i].getElementsByClassName("bm")[0].style.height=updatedDim.d+"em";selectionBinder.set("w",updatedDim.w),selectionBinder.set("d",updatedDim.d),selectionBinder.set("h",updatedDim.h);for(var q=document.getElementsByClassName("shape-tools"),i=0;i<q.length;i++){var r=q[i].getElementsByClassName("handles-wrapper")[0],s=findParentNode("view",q[i]),t=translateCoordinates(s.id,updatedDim.w,updatedDim.h,updatedDim.d);r.style.width=t.x+"em",r.style.height=t.y+"em",r.style.marginLeft=t.x/-2+"em",r.style.marginTop=t.y/-2+"em"}}if("cylinder"===selection.type){var f=snapping(grabO.diameter-em(d.x)),g=snapping(grabO.h-em(d.y)),h=snapping(selection.diameter-em(d.z));0>=f&&(f=0),0>=g&&(g=0),0>=h&&(h=0);var u=selection.diameter;f!==selection.diameter&&(u=f),h!==selection.diameter&&(u=h),updatedDim={diameter:u,h:g};for(var i=0;i<e.length;i++){e[i].style.width=updatedDim.diameter+"em",e[i].style.height=updatedDim.h+"em",e[i].style.margin=-updatedDim.h/2+"em 0 0 "+-updatedDim.diameter/2+"em",e[i].getElementsByClassName("tp")[0].style.width=updatedDim.diameter+"em",e[i].getElementsByClassName("tp")[0].style.height=updatedDim.diameter+"em",e[i].getElementsByClassName("bm")[0].style.width=updatedDim.diameter+"em",e[i].getElementsByClassName("bm")[0].style.height=updatedDim.diameter+"em";for(var v=e[i].getElementsByClassName("side"),w=360/selection.sides,x=0;x<v.length;x++){var y=x*w+w/2;v[x].style.width=calculateSidesWidth(updatedDim.diameter/2,selection.sides)+"em",v[x].style.height=updatedDim.h+"em",v[x].style[PrefixFree.Prefix+"Transform"]="rotateY("+y+"deg) translate3D(-50%,0,"+updatedDim.diameter/2+"em)"}}selectionBinder.set("diameter",updatedDim.diameter),selectionBinder.set("h",updatedDim.h);for(var q=document.getElementsByClassName("shape-tools"),i=0;i<q.length;i++){var r=q[i].getElementsByClassName("handles-wrapper")[0],s=findParentNode("view",q[i]),t=translateCoordinates(s.id,updatedDim.diameter,updatedDim.h,updatedDim.diameter);r.style.width=t.x+"em",r.style.height=t.y+"em",r.style.marginLeft=t.x/-2+"em",r.style.marginTop=t.y/-2+"em"}}if("pyramid"===selection.type){var f=snapping(grabO.diameter-em(d.x)),g=snapping(grabO.h-em(d.y)),h=snapping(selection.diameter-em(d.z));0>=f&&(f=0),0>=g&&(g=0),0>=h&&(h=0);var u=selection.diameter;f!==selection.diameter&&(u=f),h!==selection.diameter&&(u=h),updatedDim={diameter:u,h:g};for(var o=pythagoras(updatedDim.diameter/2,updatedDim.h),p=prismAngle(o,updatedDim.h),z=o/(updatedDim.diameter/2),i=0;i<e.length;i++){var A=e[i].getElementsByClassName("face-wrapper");e[i].style.width=updatedDim.diameter+"em",e[i].style.height=updatedDim.h+"em",e[i].style.margin=-updatedDim.h/2+"em 0 0 "+-updatedDim.diameter/2+"em";for(var x=0;x<e.length;x++)A[x].style.width=updatedDim.diameter+"em",A[x].style.height=updatedDim.diameter/2+"em",A[x].getElementsByClassName("face")[0].style.width=updatedDim.diameter+"em",A[x].getElementsByClassName("face")[0].style.height=updatedDim.diameter+"em";e[i].getElementsByClassName("ft")[0].style[PrefixFree.Prefix+"Transform"]="scaleZ("+z+") scaleY("+z+") rotateX("+p+"deg)",e[i].getElementsByClassName("bk")[0].style[PrefixFree.Prefix+"Transform"]="scaleZ("+z+") scaleY("+z+") rotateX(-"+p+"deg) rotateY(180deg)",e[i].getElementsByClassName("rt")[0].style[PrefixFree.Prefix+"Transform"]="scaleX("+z+") scaleY("+z+") rotateZ("+p+"deg) rotateY(-90deg)",e[i].getElementsByClassName("lt")[0].style[PrefixFree.Prefix+"Transform"]="scaleX("+z+") scaleY("+z+") rotateZ(-"+p+"deg) rotateY(90deg)",e[i].getElementsByClassName("bm")[0].style.width=updatedDim.diameter+"em",e[i].getElementsByClassName("bm")[0].style.height=updatedDim.diameter+"em"}selectionBinder.set("diameter",updatedDim.diameter),selectionBinder.set("h",updatedDim.h);for(var q=document.getElementsByClassName("shape-tools"),i=0;i<q.length;i++){var r=q[i].getElementsByClassName("handles-wrapper")[0],s=findParentNode("view",q[i]),t=translateCoordinates(s.id,updatedDim.diameter,updatedDim.h,updatedDim.diameter);r.style.width=t.x+"em",r.style.height=t.y+"em",r.style.marginLeft=t.x/-2+"em",r.style.marginTop=t.y/-2+"em"}}context.getElementsByClassName("scene")[0].classList.add("stop-transition"),reverseCamera(context,selection.id,selection.x,selection.y,selection.z,selection.rx,selection.ry,selection.rz)}function dropTool(a){if(context.getElementsByClassName("scene")[0].classList.remove("stop-transition"),mouseDown&&(a.preventDefault(),mouseDown=!1,mouseMoved)){mouseMoved=!1,storeActions("update",selection),"move"===handle&&(selection.x=updatedPos.x,selection.y=updatedPos.y,selection.z=updatedPos.z),"circle"===handle&&(selection.rx=updatedRot.rx,selection.ry=updatedRot.ry,selection.rz=updatedRot.rz),("square"===handle&&"cuboid"===selection.type||"square"===handle&&"prism"===selection.type)&&(selection.w=updatedDim.w,selection.h=updatedDim.h,selection.d=updatedDim.d),("square"===handle&&"cylinder"===selection.type||"square"===handle&&"pyramid"===selection.type)&&(selection.diameter=updatedDim.diameter,selection.h=updatedDim.h);for(var b=document.getElementsByClassName(selection.id),c=0;c<b.length;c++)removeStyles(b[c]);removeClass("dragged"),updateCSS(selection),updateURL()}}function keyboardShortcuts(){function a(a){var b={};for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);addShape(b)}Mousetrap.bind(["command+z","ctrl+z"],function(){return HistoryManager.undoAction(),!1}),Mousetrap.bind(["command+shift+z","ctrl+shift+z"],function(){return HistoryManager.redoAction(),!1}),Mousetrap.bind(["command+o","ctrl+o"],function(){return openModal("open-doc-modal"),openDocumentDialog(),!1}),Mousetrap.bind(["command+s","ctrl+s"],function(){return saveDocument(),!1}),Mousetrap.bind(["shift+alt+n","shift+alt+n"],function(){return openModal("new-doc-modal"),!1}),Mousetrap.bind(["esc"],function(){return closeModals(),!1}),Mousetrap.bind(["e"],function(){return editView(),!1}),Mousetrap.bind(["m"],function(){return moveView(),!1}),Mousetrap.bind(["d"],function(){return"undefined"!=typeof selection&&null!==selection?(duplicateShape(selection),!1):void 0}),Mousetrap.bind(["backspace"],function(){return"undefined"!=typeof selection?(storeActions("delete",selection),deleteShape(selection),!1):void 0}),Mousetrap.bind(["1"],function(){return a(Models.cuboid()),!1}),Mousetrap.bind(["2"],function(){return a(Models.cylinder()),!1}),Mousetrap.bind(["3"],function(){return a(Models.prism()),!1}),Mousetrap.bind(["4"],function(){return a(Models.pyramid()),!1}),Mousetrap.bind(["c"],function(){return centerSceneViews(),!1}),Mousetrap.bind(["+"],function(){return zoomIn(),!1}),Mousetrap.bind(["-"],function(){return zoomOut(),!1})}function socialStuff(){!function(a,b,c){var d,e=a.getElementsByTagName(b)[0];a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src="//connect.facebook.net/en_US/all.js#xfbml=1&appId=185994498248843",e.parentNode.insertBefore(d,e))}(document,"script","facebook-jssdk"),!function(a,b,c){var d,e=a.getElementsByTagName(b)[0],f=/^http:/.test(a.location)?"http":"http";a.getElementById(c)||(d=a.createElement(b),d.id=c,d.src=f+"://platform.twitter.com/widgets.js",e.parentNode.insertBefore(d,e))}(document,"script","twitter-wjs"),function(){var a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src="http://apis.google.com/js/plusone.js";var b=document.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b)}();var a=[];a.factory=function(b){return function(){a.push([b].concat(Array.prototype.slice.call(arguments,0)))}},a.on=a.factory("on"),a.once=a.factory("once"),a.off=a.factory("off"),a.emit=a.factory("emit"),a.load=function(){var a="hn-button.js";if(!document.getElementById(a)){var b=document.createElement("script");b.id=a,b.src="//hn-button.herokuapp.com/hn-button.js";var c=document.getElementsByTagName("script")[0];c.parentNode.insertBefore(b,c)}},a.load()}function init(){app.style.display="block",document.getElementById("denied").style.display="none",new FastClick(document.body),camera("view3D","scene3D",-45,-45),updateDocumentSettings(),togglePanes(),addShape(),editShape(),HistoryManager.init(),deselectShapes(),editorSwitch(),keyboardShortcuts(),parseURL(),updateURL(),AppStatus.stopLoading(),updateLight(settings.light),centerSceneViews(),socialStuff()}!function(a){function b(a){var b,c="";for(b in a)a.hasOwnProperty(b)&&"undefined"!=typeof a[b]&&(c+=b+"="+a[b]+"&");return c.replace(/&$/,"")}function c(a,c,f){for(var h=+new Date,i=document.createElement("script");"undefined"!=typeof g.__jsonp_callbacks[h];)h+=Math.random();g.__jsonp_callbacks[h]=function(){delete g.__jsonp_callbacks[h],c.apply(f,arguments)},a="?format=jsonp&callback="+encodeURIComponent("yourls.__jsonp_callbacks["+h+"]")+"&"+a,a+="&"+b(e),i.setAttribute("src",d+a),document.getElementsByTagName("head")[0].appendChild(i)}var d="",e={},f=a.yourls,g={};g.__jsonp_callbacks={},g.VERSION="1.0.0",g.connect=function(a,b){return d=a,e={},b&&(b.signature?e.signature=b.signature:(e.password=b.password,e.username=b.username)),this},g.shorten=function(a,d,e,f){var g={action:"shorturl",url:a};return"function"==typeof d?e=d:g.keyword=d,c(b(g),e,f),this},g.stats=function(a,d,e,f){var g={action:"stats"},h=typeof a;switch(h){case"number":g.limit=a,e=d;break;case"function":e=a;break;default:g.filter=a,"function"==typeof d?e=d:g.limit=d}return c(b(g),e,f),this},g.url=function(a){return this instanceof g.url?(this.url=a,void 0):new g.url(a)},g.url.prototype.expand=function(a,d){return c(b({action:"expand",shorturl:this.url}),a,d),this},g.url.prototype.stats=function(a,d){return c(b({action:"url-stats",shorturl:this.url}),a,d),this},g.noConflict=function(){return a.yourls=f,this},"function"==typeof define&&define.amd?define("yourls",function(){return g}):a.yourls=g}(this),FastClick.prototype.deviceIsAndroid=navigator.userAgent.indexOf("Android")>0,FastClick.prototype.deviceIsIOS=/iP(ad|hone|od)/.test(navigator.userAgent),FastClick.prototype.deviceIsIOS4=FastClick.prototype.deviceIsIOS&&/OS 4_\d(_\d)?/.test(navigator.userAgent),FastClick.prototype.deviceIsIOSWithBadTarget=FastClick.prototype.deviceIsIOS&&/OS ([6-9]|\d{2})_\d/.test(navigator.userAgent),FastClick.prototype.needsClick=function(a){"use strict";switch(a.nodeName.toLowerCase()){case"button":case"select":case"textarea":if(a.disabled)return!0;break;case"input":if(this.deviceIsIOS&&"file"===a.type||a.disabled)return!0;break;case"label":case"video":return!0}return/\bneedsclick\b/.test(a.className)},FastClick.prototype.needsFocus=function(a){"use strict";switch(a.nodeName.toLowerCase()){case"textarea":case"select":return!0;case"input":switch(a.type){case"button":case"checkbox":case"file":case"image":case"radio":case"submit":return!1}return!a.disabled&&!a.readOnly;default:return/\bneedsfocus\b/.test(a.className)}},FastClick.prototype.sendClick=function(a,b){"use strict";var c,d;document.activeElement&&document.activeElement!==a&&document.activeElement.blur(),d=b.changedTouches[0],c=document.createEvent("MouseEvents"),c.initMouseEvent("click",!0,!0,window,1,d.screenX,d.screenY,d.clientX,d.clientY,!1,!1,!1,!1,0,null),c.forwardedTouchEvent=!0,a.dispatchEvent(c)},FastClick.prototype.focus=function(a){"use strict";var b;this.deviceIsIOS&&a.setSelectionRange?(b=a.value.length,a.setSelectionRange(b,b)):a.focus()},FastClick.prototype.updateScrollParent=function(a){"use strict";var b,c;if(b=a.fastClickScrollParent,!b||!b.contains(a)){c=a;do{if(c.scrollHeight>c.offsetHeight){b=c,a.fastClickScrollParent=c;break}c=c.parentElement}while(c)}b&&(b.fastClickLastScrollTop=b.scrollTop)},FastClick.prototype.getTargetElementFromEventTarget=function(a){"use strict";return a.nodeType===Node.TEXT_NODE?a.parentNode:a},FastClick.prototype.onTouchStart=function(a){"use strict";var b,c,d;if(b=this.getTargetElementFromEventTarget(a.target),c=a.targetTouches[0],this.deviceIsIOS){if(d=window.getSelection(),d.rangeCount&&!d.isCollapsed)return!0;if(!this.deviceIsIOS4){if(c.identifier===this.lastTouchIdentifier)return a.preventDefault(),!1;this.lastTouchIdentifier=c.identifier,this.updateScrollParent(b)}}return this.trackingClick=!0,this.trackingClickStart=a.timeStamp,this.targetElement=b,this.touchStartX=c.pageX,this.touchStartY=c.pageY,a.timeStamp-this.lastClickTime<200&&a.preventDefault(),!0},FastClick.prototype.touchHasMoved=function(a){"use strict";var b=a.changedTouches[0];return Math.abs(b.pageX-this.touchStartX)>10||Math.abs(b.pageY-this.touchStartY)>10?!0:!1},FastClick.prototype.findControl=function(a){"use strict";return void 0!==a.control?a.control:a.htmlFor?document.getElementById(a.htmlFor):a.querySelector("button, input:not([type=hidden]), keygen, meter, output, progress, select, textarea")},FastClick.prototype.onTouchEnd=function(a){"use strict";var b,c,d,e,f,g=this.targetElement;if(this.touchHasMoved(a)&&(this.trackingClick=!1,this.targetElement=null),!this.trackingClick)return!0;if(a.timeStamp-this.lastClickTime<200)return this.cancelNextClick=!0,!0;if(this.lastClickTime=a.timeStamp,c=this.trackingClickStart,this.trackingClick=!1,this.trackingClickStart=0,this.deviceIsIOSWithBadTarget&&(f=a.changedTouches[0],g=document.elementFromPoint(f.pageX-window.pageXOffset,f.pageY-window.pageYOffset)),d=g.tagName.toLowerCase(),"label"===d){if(b=this.findControl(g)){if(this.focus(g),this.deviceIsAndroid)return!1;g=b}}else if(this.needsFocus(g))return a.timeStamp-c>100||this.deviceIsIOS&&window.top!==window&&"input"===d?(this.targetElement=null,!1):(this.focus(g),this.deviceIsIOS4&&"select"===d||(this.targetElement=null,a.preventDefault()),!1);return this.deviceIsIOS&&!this.deviceIsIOS4&&(e=g.fastClickScrollParent,e&&e.fastClickLastScrollTop!==e.scrollTop)?!0:(this.needsClick(g)||(a.preventDefault(),this.sendClick(g,a)),!1)},FastClick.prototype.onTouchCancel=function(){"use strict";this.trackingClick=!1,this.targetElement=null},FastClick.prototype.onMouse=function(a){"use strict";return this.targetElement?a.forwardedTouchEvent?!0:a.cancelable?!this.needsClick(this.targetElement)||this.cancelNextClick?(a.stopImmediatePropagation?a.stopImmediatePropagation():a.propagationStopped=!0,a.stopPropagation(),a.preventDefault(),!1):!0:!0:!0},FastClick.prototype.onClick=function(a){"use strict";var b;return this.trackingClick?(this.targetElement=null,this.trackingClick=!1,!0):"submit"===a.target.type&&0===a.detail?!0:(b=this.onMouse(a),b||(this.targetElement=null),b)},FastClick.prototype.destroy=function(){"use strict";var a=this.layer;this.deviceIsAndroid&&(a.removeEventListener("mouseover",this.onMouse,!0),a.removeEventListener("mousedown",this.onMouse,!0),a.removeEventListener("mouseup",this.onMouse,!0)),a.removeEventListener("click",this.onClick,!0),a.removeEventListener("touchstart",this.onTouchStart,!1),a.removeEventListener("touchend",this.onTouchEnd,!1),a.removeEventListener("touchcancel",this.onTouchCancel,!1)},FastClick.notNeeded=function(){"use strict";var a;if("undefined"==typeof window.ontouchstart)return!0;if(/Chrome\/[0-9]+/.test(navigator.userAgent)){if(!FastClick.prototype.deviceIsAndroid)return!0;if(a=document.querySelector("meta[name=viewport]"),a&&-1!==a.content.indexOf("user-scalable=no"))return!0}return!1},FastClick.attach=function(a){"use strict";return new FastClick(a)},"undefined"!=typeof define&&define.amd?define(function(){"use strict";return FastClick}):"undefined"!=typeof module&&module.exports?(module.exports=FastClick.attach,module.exports.FastClick=FastClick):window.FastClick=FastClick,function(){function a(a,b){function c(){return n=a.charAt(++p)}function d(){return a.charAt(p+1)}function e(b){for(var d=p;c();)if("\\"===n)c(),c();else{if(n===b)break;if("\n"===n)break}return a.substring(d,p+1)}function f(){for(var a=p;o.test(d());)p++;return p!==a}function g(){var a=p;do;while(o.test(c()));return p!==a+1}function h(){var b=p;for(c();c();)if("*"===n&&"/"===d()){p++;break}return a.substring(b,p+1)}function i(b){return a.substring(p-b.length,p).toLowerCase()===b}function j(){s++,q+=r}function k(){s--,q=q.slice(0,-l)}b=b||{};var l=b.indent_size||4,m=b.indent_char||" ";"string"==typeof l&&(l=parseInt(l,10));var n,o=/^\s+$/,p=-1,q=a.match(/^[\r\n]*[\t ]*/)[0],r=Array(l+1).join(m),s=0,t={};t["{"]=function(a){t.singleSpace(),u.push(a),t.newLine()},t["}"]=function(a){t.newLine(),u.push(a),t.newLine()},t.newLine=function(a){if(!a)for(;o.test(u[u.length-1]);)u.pop();u.length&&u.push("\n"),q&&u.push(q)},t.singleSpace=function(){u.length&&!o.test(u[u.length-1])&&u.push(" ")};var u=[];for(q&&u.push(q);;){var v=g();if(!n)break;"{"===n?(j(),t["{"](n)):"}"===n?(k(),t["}"](n)):'"'===n||"'"===n?u.push(e(n)):";"===n?u.push(n,"\n",q):"/"===n&&"*"===d()?(t.newLine(),u.push(h(),"\n",q)):"("===n?i("url")?(u.push(n),f(),c()&&(")"!==n&&'"'!==n&&"'"!==n?u.push(e(")")):p--)):(v&&t.singleSpace(),u.push(n),f()):")"===n?u.push(n):","===n?(f(),u.push(n),t.singleSpace()):"]"===n?u.push(n):"["===n||"="===n?(f(),u.push(n)):(v&&t.singleSpace(),u.push(n))}var w=u.join("").replace(/[\n ]+$/,"");return w}"function"==typeof define?define(function(b,c){c.css_beautify=a}):"undefined"!=typeof exports?exports.css_beautify=a:"undefined"!=typeof window?window.css_beautify=a:"undefined"!=typeof global&&(global.css_beautify=a)}(),function(){function a(a){return a.replace(/^\s+|\s+$/g,"")}function b(a){return a.replace(/^\s+/g,"")}function c(c,d,e,f){function g(){return this.pos=0,this.token="",this.current_mode="CONTENT",this.tags={parent:"parent1",parentcount:1,parent1:""},this.tag_type="",this.token_text=this.last_token=this.last_text=this.token_type="",this.newlines=0,this.indent_content=!1,this.Utils={whitespace:"\n\r	 ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed,?php,?,?=".split(","),extra_liners:"head,body,/html".split(","),in_array:function(a,b){for(var c=0;c<b.length;c++)if(a===b[c])return!0;return!1}},this.traverse_whitespace=function(){var a="";if(a=this.input.charAt(this.pos),this.Utils.in_array(a,this.Utils.whitespace)){for(this.newlines=0;this.Utils.in_array(a,this.Utils.whitespace);)n&&"\n"===a&&this.newlines<=o&&(this.newlines+=1),this.pos++,a=this.input.charAt(this.pos);return!0}return!1},this.get_content=function(){for(var a="",b=[],c=!1;"<"!==this.input.charAt(this.pos);){if(this.pos>=this.input.length)return b.length?b.join(""):["","TK_EOF"];this.traverse_whitespace()?b.length&&(c=!0):(a=this.input.charAt(this.pos),this.pos++,c&&(this.line_char_count>=this.wrap_line_length?(this.print_newline(!1,b),this.print_indentation(b)):(this.line_char_count++,b.push(" ")),c=!1),this.line_char_count++,b.push(a))}return b.length?b.join(""):""},this.get_contents_to=function(a){if(this.pos===this.input.length)return["","TK_EOF"];var b="",c=new RegExp("</"+a+"\\s*>","igm");c.lastIndex=this.pos;var d=c.exec(this.input),e=d?d.index:this.input.length;return this.pos<e&&(b=this.input.substring(this.pos,e),this.pos=e),b},this.record_tag=function(a){this.tags[a+"count"]?(this.tags[a+"count"]++,this.tags[a+this.tags[a+"count"]]=this.indent_level):(this.tags[a+"count"]=1,this.tags[a+this.tags[a+"count"]]=this.indent_level),this.tags[a+this.tags[a+"count"]+"parent"]=this.tags.parent,this.tags.parent=a+this.tags[a+"count"]},this.retrieve_tag=function(a){if(this.tags[a+"count"]){for(var b=this.tags.parent;b&&a+this.tags[a+"count"]!==b;)b=this.tags[b+"parent"];b&&(this.indent_level=this.tags[a+this.tags[a+"count"]],this.tags.parent=this.tags[b+"parent"]),delete this.tags[a+this.tags[a+"count"]+"parent"],delete this.tags[a+this.tags[a+"count"]],1===this.tags[a+"count"]?delete this.tags[a+"count"]:this.tags[a+"count"]--}},this.get_tag=function(a){var b,c,d="",e=[],f="",g=!1,h=this.pos,i=this.line_char_count;a=void 0!==a?a:!1;do{if(this.pos>=this.input.length)return a&&(this.pos=h,this.line_char_count=i),e.length?e.join(""):["","TK_EOF"];if(d=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(d,this.Utils.whitespace))g=!0;
else if(("'"===d||'"'===d)&&(d+=this.get_unformatted(d),g=!0),"="===d&&(g=!1),e.length&&"="!==e[e.length-1]&&">"!==d&&g&&(this.line_char_count>=this.wrap_line_length?(this.print_newline(!1,e),this.print_indentation(e)):(e.push(" "),this.line_char_count++),g=!1),"<"!==d||b||(b=this.pos-1),this.line_char_count++,e.push(d),e[1]&&"!"===e[1]){e=[this.get_comment(b)];break}}while(">"!==d);var j,k=e.join("");j=-1!==k.indexOf(" ")?k.indexOf(" "):k.indexOf(">");var l=k.substring(1,j).toLowerCase();return"/"===k.charAt(k.length-2)||this.Utils.in_array(l,this.Utils.single_token)?a||(this.tag_type="SINGLE"):"script"===l?a||(this.record_tag(l),this.tag_type="SCRIPT"):"style"===l?a||(this.record_tag(l),this.tag_type="STYLE"):this.is_unformatted(l,m)?(f=this.get_unformatted("</"+l+">",k),e.push(f),b>0&&this.Utils.in_array(this.input.charAt(b-1),this.Utils.whitespace)&&e.splice(0,0,this.input.charAt(b-1)),c=this.pos-1,this.Utils.in_array(this.input.charAt(c+1),this.Utils.whitespace)&&e.push(this.input.charAt(c+1)),this.tag_type="SINGLE"):"!"===l.charAt(0)?a||(this.tag_type="SINGLE",this.traverse_whitespace()):a||("/"===l.charAt(0)?(this.retrieve_tag(l.substring(1)),this.tag_type="END",this.traverse_whitespace()):(this.record_tag(l),"html"!==l.toLowerCase()&&(this.indent_content=!0),this.tag_type="START",this.traverse_whitespace()),this.Utils.in_array(l,this.Utils.extra_liners)&&(this.print_newline(!1,this.output),this.output.length&&"\n"!==this.output[this.output.length-2]&&this.print_newline(!0,this.output))),a&&(this.pos=h,this.line_char_count=i),e.join("")},this.get_comment=function(a){var b="",c=">",d=!1;for(this.pos=a,input_char=this.input.charAt(this.pos),this.pos++;this.pos<=this.input.length&&(b+=input_char,b[b.length-1]!==c[c.length-1]||-1===b.indexOf(c));)!d&&b.length<10&&(0===b.indexOf("<![if")?(c="<![endif]>",d=!0):0===b.indexOf("<![cdata[")?(c="]]>",d=!0):0===b.indexOf("<![")?(c="]>",d=!0):0===b.indexOf("<!--")&&(c="-->",d=!0)),input_char=this.input.charAt(this.pos),this.pos++;return b},this.get_unformatted=function(a,b){if(b&&-1!==b.toLowerCase().indexOf(a))return"";var c="",d="",e=!0;do{if(this.pos>=this.input.length)return d;if(c=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(c,this.Utils.whitespace)){if(!e){this.line_char_count--;continue}if("\n"===c||"\r"===c){d+="\n",this.line_char_count=0;continue}}d+=c,this.line_char_count++,e=!0}while(-1===d.toLowerCase().indexOf(a));return d},this.get_token=function(){var a;if("TK_TAG_SCRIPT"===this.last_token||"TK_TAG_STYLE"===this.last_token){var b=this.last_token.substr(7);return a=this.get_contents_to(b),"string"!=typeof a?a:[a,"TK_"+b]}if("CONTENT"===this.current_mode)return a=this.get_content(),"string"!=typeof a?a:[a,"TK_CONTENT"];if("TAG"===this.current_mode){if(a=this.get_tag(),"string"!=typeof a)return a;var c="TK_TAG_"+this.tag_type;return[a,c]}},this.get_full_indent=function(a){return a=this.indent_level+a||0,1>a?"":Array(a+1).join(this.indent_string)},this.is_unformatted=function(a,b){if(!this.Utils.in_array(a,b))return!1;if("a"!==a.toLowerCase()||!this.Utils.in_array("a",b))return!0;var c=this.get_tag(!0),d=(c||"").match(/^\s*<\s*\/?([a-z]*)\s*[^>]*>\s*$/);return!d||this.Utils.in_array(d,b)?!0:!1},this.printer=function(a,c,d,e,f){this.input=a||"",this.output=[],this.indent_character=c,this.indent_string="",this.indent_size=d,this.brace_style=f,this.indent_level=0,this.wrap_line_length=e,this.line_char_count=0;for(var g=0;g<this.indent_size;g++)this.indent_string+=this.indent_character;this.print_newline=function(a,b){this.line_char_count=0,b&&b.length&&(a||"\n"!==b[b.length-1])&&b.push("\n")},this.print_indentation=function(a){for(var b=0;b<this.indent_level;b++)a.push(this.indent_string),this.line_char_count+=this.indent_string.length},this.print_token=function(a){(a||""!==a)&&this.output.length&&"\n"===this.output[this.output.length-1]&&(this.print_indentation(this.output),a=b(a)),this.print_token_raw(a)},this.print_token_raw=function(a){a&&""!==a&&(a.length>1&&"\n"===a[a.length-1]?(this.output.push(a.slice(0,-1)),this.print_newline(!1,this.output)):this.output.push(a));for(var b=0;b<this.newlines;b++)this.print_newline(b>0,this.output);this.newlines=0},this.indent=function(){this.indent_level++},this.unindent=function(){this.indent_level>0&&this.indent_level--}},this}var h,i,j,k,l,m,n,o;for(d=d||{},void 0===d.wrap_line_length&&void 0!==d.max_char&&(d.wrap_line_length=d.max_char),i=parseInt(d.indent_size||4,10),j=d.indent_char||" ",l=d.brace_style||"collapse",k=0===d.wrap_line_length?32786:parseInt(d.wrap_line_length||250,10),m=d.unformatted||["a","span","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6"],n=d.preserve_newlines||!0,o=n?parseInt(d.max_preserve_newlines||32786,10):0,h=new g,h.printer(c,j,i,k,l);;){var p=h.get_token();if(h.token_text=p[0],h.token_type=p[1],"TK_EOF"===h.token_type)break;switch(h.token_type){case"TK_TAG_START":h.print_newline(!1,h.output),h.print_token(h.token_text),h.indent_content&&(h.indent(),h.indent_content=!1),h.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":h.print_newline(!1,h.output),h.print_token(h.token_text),h.current_mode="CONTENT";break;case"TK_TAG_END":if("TK_CONTENT"===h.last_token&&""===h.last_text){var q=h.token_text.match(/\w+/)[0],r=h.output[h.output.length-1].match(/<\s*(\w+)/);(null===r||r[1]!==q)&&h.print_newline(!1,h.output)}h.print_token(h.token_text),h.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var s=h.token_text.match(/^\s*<([a-z]+)/i);s&&h.Utils.in_array(s[1],m)||h.print_newline(!1,h.output),h.print_token(h.token_text),h.current_mode="CONTENT";break;case"TK_CONTENT":h.print_token(h.token_text),h.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(""!==h.token_text){h.print_newline(!1,h.output);var t,u=h.token_text,v=1;"TK_SCRIPT"===h.token_type?t="function"==typeof e&&e:"TK_STYLE"===h.token_type&&(t="function"==typeof f&&f),"keep"===d.indent_scripts?v=0:"separate"===d.indent_scripts&&(v=-h.indent_level);var w=h.get_full_indent(v);if(t)u=t(u.replace(/^\s*/,w),d);else{var x=u.match(/^\s*/)[0],y=x.match(/[^\n\r]*$/)[0].split(h.indent_string).length-1,z=h.get_full_indent(v-y);u=u.replace(/^\s*/,w).replace(/\r\n|\r|\n/g,"\n"+z).replace(/\s+$/,"")}u&&(h.print_token_raw(w+a(u)),h.print_newline(!1,h.output))}h.current_mode="TAG"}h.last_token=h.token_type,h.last_text=h.token_text}return h.output.join("")}if("function"==typeof define)define(["./beautify.js","./beautify-css.js"],function(a,b){return{html_beautify:function(d,e){return c(d,e,a,b)}}});else if("undefined"!=typeof exports){var d=require("./beautify.js").js_beautify,e=require("./beautify-css.js").css_beautify;exports.html_beautify=function(a,b){return c(a,b,d,e)}}else"undefined"!=typeof window?window.html_beautify=function(a,b){return c(a,b,window.js_beautify,window.css_beautify)}:"undefined"!=typeof global&&(global.html_beautify=function(a,b){return c(a,b,global.js_beautify,global.css_beautify)})}();var Photon={version:"0.0.3",degToRad:function(a){return a*Math.PI/180},radToDeg:function(a){return 180*a/Math.PI},getRotationVector:function(a,b){var c=a.rotate(b.x,Line.create([0,0,0],[1,0,0])),d=c.rotate(b.y,Line.create([0,0,0],[0,1,0])),e=d.rotate(b.z,Line.create([0,0,0],[0,0,1]));return e},getTransformString:function(){if(Photon.transformString)return Photon.transformString;for(var a,b=["transform","webkitTransform","MozTransform","msTransform","OTransform"],c=document.createElement("div"),d=0;d<b.length;d++)""==c.style[b[d]]&&(a=b[d]);return Photon.transformString=a,a},buildMatrix:function(a){var b=new FirminCSSMatrix(a);return b.m11=1e16*b.m11,b.m12=1e16*b.m12,b.m13=1e16*b.m13,b.m14=1e16*b.m14,b.m21=1e16*b.m21,b.m22=1e16*b.m22,b.m23=1e16*b.m23,b.m24=1e16*b.m24,b.m31=1e16*b.m31,b.m32=1e16*b.m32,b.m33=1e16*b.m33,b.m34=1e16*b.m34,b.m41=1e16*b.m41,b.m42=1e16*b.m42,b.m43=1e16*b.m43,b.m44=1e16*b.m44,b}};Photon.Light=function(a,b,c){this.moveTo(a||0,b||0,c||100),this.calculateVector()},Photon.Light.prototype={moveTo:function(a,b,c){this.x=a,this.y=b,this.z=c,this.calculateVector()},calculateVector:function(){this.magnitude=Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z),this.vector=$V([this.x/this.magnitude,this.y/this.magnitude,this.z/this.magnitude])}},Photon.Face=function(a,b,c,d){this.element=a,this.maxShade=b||.5,this.maxTint=c||0,this.isBackfaced=d||!1,this.shaderElement=new Photon.ShaderElement(this.element),this.element.insertBefore(this.shaderElement,this.element.firstChild),this.transformString=Photon.getTransformString(),this.getRotations()},Photon.Face.prototype={getRotations:function(){var a;a=this.element.parentNode.classList.contains("face-wrapper")?this.element.parentNode:this.element;var b=window.getComputedStyle(a)[this.transformString]||"matrix3d(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)";this.matrix=Photon.buildMatrix(b);var c=this.matrix.decompose();this.rotations={x:c.rotate.x,y:c.rotate.y,z:c.rotate.z},this.vector=Photon.getRotationVector($V([0,0,1]),this.rotations)},render:function(a,b,c,d){b&&this.getRotations();var e;e=c?Photon.getRotationVector(this.vector,c):this.vector,d&&(childVector=Photon.getRotationVector(this.vector,c),e=Photon.getRotationVector(childVector,d)),this.angleFrom=Photon.radToDeg(a.vector.angleFrom(e));var f,g=this.isBackfaced?this.angleFrom/180:this.angleFrom/90;this.isBackfaced&&g>.5&&(g=1-g);var h=Math.abs(this.maxShade+this.maxTint),i=h*g;this.rangedPercentage=i,f=i<=this.maxTint?"rgba(255, 255, 255, "+Math.abs(this.maxTint-i)+")":"rgba(0, 0, 0, "+Math.abs(i-this.maxTint)+")",this.shaderElement.style.backgroundColor=f},setMaxShade:function(a){this.maxShade=a},setMaxTint:function(a){this.maxTint=a}},Photon.ShaderElement=function(){var a=document.createElement("div");return a.className="photon-shader",a},Photon.FaceGroup=function(a,b,c,d,e,f){this.element=a,this.faces=[],this.transformString=Photon.getTransformString(),this.parentScene=f;for(var g=b,h=0;h<g.length;h++)this.faces[h]=new Photon.Face(g[h],c,d,e)},Photon.FaceGroup.prototype={getRotations:function(){var a=window.getComputedStyle(this.element)[this.transformString]||"matrix3d(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)";this.matrix=Photon.buildMatrix(a);var b=this.matrix.decompose();this.rotations={x:b.rotate.x,y:b.rotate.y,z:b.rotate.z},this.vector=Photon.getRotationVector($V([0,0,1]),this.rotations)},getSceneRotations:function(){var a=window.getComputedStyle(this.parentScene)[this.transformString]||"matrix3d(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0)";this.matrix=Photon.buildMatrix(a);var b=this.matrix.decompose();this.sceneRotations={x:b.rotate.x,y:b.rotate.y,z:b.rotate.z},this.sceneVector=Photon.getRotationVector($V([0,0,1]),this.rotations)},render:function(a,b,c){b&&(this.getRotations(),this.getSceneRotations()),this.angleFrom=Photon.radToDeg(a.vector.angleFrom(this.vector));for(var d=0,e=this.faces.length;e>d;d++)this.faces[d].render(a,c,this.rotations,this.sceneRotations)},setMaxShade:function(a){for(var b=0;b<this.faces.length;b++)this.faces[b].setMaxShade(a)},setMaxTint:function(a){for(var b=0;b<this.faces.length;b++)this.faces[b].setMaxTint(a)}};var Sylvester={version:"0.1.3",precision:1e-6};Vector.prototype={modulus:function(){return Math.sqrt(this.dot(this))},dup:function(){return Vector.create(this.elements)},each:function(a){var b,c=this.elements.length,d=c;do b=d-c,a(this.elements[b],b+1);while(--c)},angleFrom:function(a){var b=a.elements||a,c=this.elements.length;if(c!=b.length)return null;var d=0,e=0,f=0;if(this.each(function(a,c){d+=a*b[c-1],e+=a*a,f+=b[c-1]*b[c-1]}),e=Math.sqrt(e),f=Math.sqrt(f),0===e*f)return null;var g=d/(e*f);return-1>g&&(g=-1),g>1&&(g=1),Math.acos(g)},dot:function(a){var b=a.elements||a,c=0,d=this.elements.length;if(d!=b.length)return null;do c+=this.elements[d-1]*b[d-1];while(--d);return c},rotate:function(a,b){var c,d,e,f,g;switch(this.elements.length){case 2:return c=b.elements||b,2!=c.length?null:(d=Matrix.Rotation(a).elements,e=this.elements[0]-c[0],f=this.elements[1]-c[1],Vector.create([c[0]+d[0][0]*e+d[0][1]*f,c[1]+d[1][0]*e+d[1][1]*f]));case 3:if(!b.direction)return null;var h=b.pointClosestTo(this).elements;return d=Matrix.Rotation(a,b.direction).elements,e=this.elements[0]-h[0],f=this.elements[1]-h[1],g=this.elements[2]-h[2],Vector.create([h[0]+d[0][0]*e+d[0][1]*f+d[0][2]*g,h[1]+d[1][0]*e+d[1][1]*f+d[1][2]*g,h[2]+d[2][0]*e+d[2][1]*f+d[2][2]*g]);default:return null}},setElements:function(a){return this.elements=(a.elements||a).slice(),this}},Vector.create=function(a){var b=new Vector;return b.setElements(a)};var $V=Vector.create;Line.prototype={distanceFrom:function(a){if(a.normal)return a.distanceFrom(this);if(a.direction){if(this.isParallelTo(a))return this.distanceFrom(a.anchor);var b=this.direction.cross(a.direction).toUnitVector().elements,c=this.anchor.elements,d=a.anchor.elements;return Math.abs((c[0]-d[0])*b[0]+(c[1]-d[1])*b[1]+(c[2]-d[2])*b[2])}var e=a.elements||a,c=this.anchor.elements,f=this.direction.elements,g=e[0]-c[0],h=e[1]-c[1],i=(e[2]||0)-c[2],j=Math.sqrt(g*g+h*h+i*i);if(0===j)return 0;var k=(g*f[0]+h*f[1]+i*f[2])/j,l=1-k*k;return Math.abs(j*Math.sqrt(0>l?0:l))},contains:function(a){var b=this.distanceFrom(a);return null!==b&&b<=Sylvester.precision},pointClosestTo:function(a){if(a.direction){if(this.intersects(a))return this.intersectionWith(a);if(this.isParallelTo(a))return null;var b=this.direction.elements,c=a.direction.elements,d=b[0],e=b[1],f=b[2],g=c[0],h=c[1],i=c[2],j=f*g-d*i,k=d*h-e*g,l=e*i-f*h,m=Vector.create([j*i-k*h,k*g-l*i,l*h-j*g]),n=Plane.create(a.anchor,m);return n.intersectionWith(this)}var n=a.elements||a;if(this.contains(n))return Vector.create(n);var o=this.anchor.elements,b=this.direction.elements,d=b[0],e=b[1],f=b[2],p=o[0],q=o[1],r=o[2],j=d*(n[1]-q)-e*(n[0]-p),k=e*((n[2]||0)-r)-f*(n[1]-q),l=f*(n[0]-p)-d*((n[2]||0)-r),s=Vector.create([e*j-f*l,f*k-d*j,d*l-e*k]),t=this.distanceFrom(n)/s.modulus();return Vector.create([n[0]+s.elements[0]*t,n[1]+s.elements[1]*t,(n[2]||0)+s.elements[2]*t])},rotate:function(a,b){"undefined"==typeof b.direction&&(b=Line.create(b.to3D(),Vector.k));var c=Matrix.Rotation(a,b.direction).elements,d=b.pointClosestTo(this.anchor).elements,e=this.anchor.elements,f=this.direction.elements,g=d[0],h=d[1],i=d[2],j=e[0],k=e[1],l=e[2],m=j-g,n=k-h,o=l-i;return Line.create([g+c[0][0]*m+c[0][1]*n+c[0][2]*o,h+c[1][0]*m+c[1][1]*n+c[1][2]*o,i+c[2][0]*m+c[2][1]*n+c[2][2]*o],[c[0][0]*f[0]+c[0][1]*f[1]+c[0][2]*f[2],c[1][0]*f[0]+c[1][1]*f[1]+c[1][2]*f[2],c[2][0]*f[0]+c[2][1]*f[1]+c[2][2]*f[2]])},setVectors:function(a,b){if(a=Vector.create(a),b=Vector.create(b),2==a.elements.length&&a.elements.push(0),2==b.elements.length&&b.elements.push(0),a.elements.length>3||b.elements.length>3)return null;var c=b.modulus();return 0===c?null:(this.anchor=a,this.direction=Vector.create([b.elements[0]/c,b.elements[1]/c,b.elements[2]/c]),this)}},Line.create=function(a,b){var c=new Line;return c.setVectors(a,b)},Matrix.prototype={setElements:function(a){var b,c=a.elements||a;if("undefined"!=typeof c[0][0]){var d,e,f,g=c.length,h=g;this.elements=[];do{b=h-g,d=c[b].length,e=d,this.elements[b]=[];do f=e-d,this.elements[b][f]=c[b][f];while(--d)}while(--g);return this}var i=c.length,j=i;this.elements=[];do b=j-i,this.elements.push([c[b]]);while(--i);return this}},Matrix.create=function(a){var b=new Matrix;return b.setElements(a)},Matrix.Rotation=function(a,b){if(!b)return Matrix.create([[Math.cos(a),-Math.sin(a)],[Math.sin(a),Math.cos(a)]]);var c=b.dup();if(3!=c.elements.length)return null;var d=c.modulus(),e=c.elements[0]/d,f=c.elements[1]/d,g=c.elements[2]/d,h=Math.sin(a),i=Math.cos(a),j=1-i;return Matrix.create([[j*e*e+i,j*e*f-h*g,j*e*g+h*f],[j*e*f+h*g,j*f*f+i,j*f*g-h*e],[j*e*g-h*f,j*f*g+h*e,j*g*g+i]])},FirminCSSMatrix=function(a){this.m11=this.m22=this.m33=this.m44=1,this.m12=this.m13=this.m14=this.m21=this.m23=this.m24=this.m31=this.m32=this.m34=this.m41=this.m42=this.m43=0,"string"==typeof a&&this.setMatrixValue(a)},FirminCSSMatrix.displayName="FirminCSSMatrix",FirminCSSMatrix.degreesToRadians=function(a){return a*Math.PI/180},FirminCSSMatrix.determinant2x2=function(a,b,c,d){return a*d-b*c},FirminCSSMatrix.determinant3x3=function(a,b,c,d,e,f,g,h,i){var j=FirminCSSMatrix.determinant2x2;return a*j(e,f,h,i)-d*j(b,c,h,i)+g*j(b,c,e,f)},FirminCSSMatrix.determinant4x4=function(a){var b=FirminCSSMatrix.determinant3x3,c=a.m11,d=a.m21,e=a.m31,f=a.m41,g=a.m12,h=a.m22,i=a.m32,j=a.m42,k=a.m13,l=a.m23,m=a.m33,n=a.m43,o=a.m14,p=a.m24,q=a.m34,r=a.m44;return c*b(h,l,p,i,m,q,j,n,r)-d*b(g,k,o,i,m,q,j,n,r)+e*b(g,k,o,h,l,p,j,n,r)-f*b(g,k,o,h,l,p,i,m,q)},[["m11","a"],["m12","b"],["m21","c"],["m22","d"],["m41","e"],["m42","f"]].forEach(function(a){var b=a[0],c=a[1];Object.defineProperty(FirminCSSMatrix.prototype,c,{set:function(a){this[b]=a},get:function(){return this[b]}})}),FirminCSSMatrix.prototype.isAffine=function(){return 0===this.m13&&0===this.m14&&0===this.m23&&0===this.m24&&0===this.m31&&0===this.m32&&1===this.m33&&0===this.m34&&0===this.m43&&1===this.m44},FirminCSSMatrix.prototype.multiply=function(a){var b=a,c=this,d=new FirminCSSMatrix;return d.m11=b.m11*c.m11+b.m12*c.m21+b.m13*c.m31+b.m14*c.m41,d.m12=b.m11*c.m12+b.m12*c.m22+b.m13*c.m32+b.m14*c.m42,d.m13=b.m11*c.m13+b.m12*c.m23+b.m13*c.m33+b.m14*c.m43,d.m14=b.m11*c.m14+b.m12*c.m24+b.m13*c.m34+b.m14*c.m44,d.m21=b.m21*c.m11+b.m22*c.m21+b.m23*c.m31+b.m24*c.m41,d.m22=b.m21*c.m12+b.m22*c.m22+b.m23*c.m32+b.m24*c.m42,d.m23=b.m21*c.m13+b.m22*c.m23+b.m23*c.m33+b.m24*c.m43,d.m24=b.m21*c.m14+b.m22*c.m24+b.m23*c.m34+b.m24*c.m44,d.m31=b.m31*c.m11+b.m32*c.m21+b.m33*c.m31+b.m34*c.m41,d.m32=b.m31*c.m12+b.m32*c.m22+b.m33*c.m32+b.m34*c.m42,d.m33=b.m31*c.m13+b.m32*c.m23+b.m33*c.m33+b.m34*c.m43,d.m34=b.m31*c.m14+b.m32*c.m24+b.m33*c.m34+b.m34*c.m44,d.m41=b.m41*c.m11+b.m42*c.m21+b.m43*c.m31+b.m44*c.m41,d.m42=b.m41*c.m12+b.m42*c.m22+b.m43*c.m32+b.m44*c.m42,d.m43=b.m41*c.m13+b.m42*c.m23+b.m43*c.m33+b.m44*c.m43,d.m44=b.m41*c.m14+b.m42*c.m24+b.m43*c.m34+b.m44*c.m44,d},FirminCSSMatrix.prototype.isIdentityOrTranslation=function(){var a=this;return 1===a.m11&&0===a.m12&&0===a.m13&&0===a.m14&&0===a.m21&&1===a.m22&&0===a.m23&&0===a.m24&&0===a.m31&&0===a.m31&&1===a.m33&&0===a.m34&&1===a.m44},FirminCSSMatrix.prototype.adjoint=function(){var a=new FirminCSSMatrix,b=this,c=FirminCSSMatrix.determinant3x3,d=b.m11,e=b.m12,f=b.m13,g=b.m14,h=b.m21,i=b.m22,j=b.m23,k=b.m24,l=b.m31,m=b.m32,n=b.m33,o=b.m34,p=b.m41,q=b.m42,r=b.m43,s=b.m44;return a.m11=c(i,m,q,j,n,r,k,o,s),a.m21=-c(h,l,p,j,n,r,k,o,s),a.m31=c(h,l,p,i,m,q,k,o,s),a.m41=-c(h,l,p,i,m,q,j,n,r),a.m12=-c(e,m,q,f,n,r,g,o,s),a.m22=c(d,l,p,f,n,r,g,o,s),a.m32=-c(d,l,p,e,m,q,g,o,s),a.m42=c(d,l,p,e,m,q,f,n,r),a.m13=c(e,i,q,f,j,r,g,k,s),a.m23=-c(d,h,p,f,j,r,g,k,s),a.m33=c(d,h,p,e,i,q,g,k,s),a.m43=-c(d,h,p,e,i,q,f,j,r),a.m14=-c(e,i,m,f,j,n,g,k,o),a.m24=c(d,h,l,f,j,n,g,k,o),a.m34=-c(d,h,l,e,i,m,g,k,o),a.m44=c(d,h,l,e,i,m,f,j,n),a},FirminCSSMatrix.prototype.inverse=function(){var a,b,c,d,e;if(this.isIdentityOrTranslation())return a=new FirminCSSMatrix,(0!==this.m41||0!==this.m42||0!==this.m43)&&(a.m41=-this.m41,a.m42=-this.m42,a.m43=-this.m43),a;if(c=this.adjoint(),b=FirminCSSMatrix.determinant4x4(this),Math.abs(b)<1e-8)return null;for(d=1;5>d;d++)for(e=1;5>e;e++)c["m"+d+e]/=b;return c},FirminCSSMatrix.prototype.rotate=function(a,b,c){var d=FirminCSSMatrix.degreesToRadians;("number"!=typeof a||isNaN(a))&&(a=0),"number"==typeof b&&!isNaN(b)||"number"==typeof c&&!isNaN(c)||(c=a,a=0,b=0),("number"!=typeof b||isNaN(b))&&(b=0),("number"!=typeof c||isNaN(c))&&(c=0),a=d(a),b=d(b),c=d(c);var e,f,g,h=new FirminCSSMatrix,i=new FirminCSSMatrix,j=new FirminCSSMatrix;return c/=2,e=Math.sin(c),f=Math.cos(c),g=e*e,j.m11=j.m22=1-2*g,j.m12=j.m21=2*e*f,j.m21*=-1,b/=2,e=Math.sin(b),f=Math.cos(b),g=e*e,i.m11=i.m33=1-2*g,i.m13=i.m31=2*e*f,i.m13*=-1,a/=2,e=Math.sin(a),f=Math.cos(a),g=e*e,h.m22=h.m33=1-2*g,h.m23=h.m32=2*e*f,h.m32*=-1,j.multiply(i).multiply(h).multiply(this)},FirminCSSMatrix.prototype.rotateAxisAngle=function(a,b,c,d){("number"!=typeof a||isNaN(a))&&(a=0),("number"!=typeof b||isNaN(b))&&(b=0),("number"!=typeof c||isNaN(c))&&(c=0),("number"!=typeof d||isNaN(d))&&(d=0),0===a&&0===b&&0===c&&(c=1);var e,f,g,h,i,j,k,l=new FirminCSSMatrix,m=Math.sqrt(a*a+b*b+c*c);return d=(FirminCSSMatrix.degreesToRadians(d)||0)/2,e=Math.cos(d),f=Math.sin(d),g=f*f,0===m?(a=0,b=0,c=1):1!==m&&(a/=m,b/=m,c/=m),1===a&&0===b&&0===c?(l.m22=l.m33=1-2*g,l.m23=l.m32=2*e*f,l.m32*=-1):0===a&&1===b&&0===c?(l.m11=l.m33=1-2*g,l.m13=l.m31=2*e*f,l.m13*=-1):0===a&&0===b&&1===c?(l.m11=l.m22=1-2*g,l.m12=l.m21=2*e*f,l.m21*=-1):(h=f*e,i=a*a,j=b*b,k=c*c,l.m11=1-2*(j+k)*g,l.m12=2*(a*b*g+c*h),l.m13=2*(a*c*g-b*h),l.m21=2*(b*a*g-c*h),l.m22=1-2*(k+i)*g,l.m23=2*(b*c*g+a*h),l.m31=2*(c*a*g+b*h),l.m32=2*(c*b*g-a*h),l.m33=1-2*(i+j)*g),this.multiply(l)},FirminCSSMatrix.prototype.scale=function(a,b,c){var d=new FirminCSSMatrix;return("number"!=typeof a||isNaN(a))&&(a=1),("number"!=typeof b||isNaN(b))&&(b=a),("number"!=typeof c||isNaN(c))&&(c=1),d.m11=a,d.m22=b,d.m33=c,this.multiply(d)},FirminCSSMatrix.prototype.translate=function(a,b,c){var d=new FirminCSSMatrix;return("number"!=typeof a||isNaN(a))&&(a=0),("number"!=typeof b||isNaN(b))&&(b=0),("number"!=typeof c||isNaN(c))&&(c=0),d.m41=a,d.m42=b,d.m43=c,this.multiply(d)},FirminCSSMatrix.prototype.setMatrixValue=function(a){a=a.trim();var b,c,d,e,f,g,h=a.match(/^matrix(3d)?\(\s*(.+)\s*\)$/);if(h&&(b=!!h[1],c=h[2].split(/\s*,\s*/),d=c.length,e=new Array(d),!(b&&16!==d||!b&&6!==d))){for(f=0;d>f;f++){if(g=c[f],!g.match(/^-?\d+(\.\d+)?$/))return;e[f]=parseFloat(g)}for(f=0;d>f;f++)point=b?"m"+(Math.floor(f/4)+1)+(f%4+1):String.fromCharCode(f+97),this[point]=e[f]}},FirminCSSMatrix.prototype.toString=function(){var a,b,c=this;return this.isAffine()?(b="matrix(",a=["a","b","c","d","e","f"]):(b="matrix3d(",a=["m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44"]),b+a.map(function(a){return c[a].toFixed(6)}).join(", ")+")"};var CSSMatrixDecomposed=function(a){void 0===a?a={}:null;var b={perspective:null,translate:null,skew:null,scale:null,rotate:null};for(var c in b)this[c]=a[c]?a[c]:new Vector4;this.tween=function(a,c,d){void 0===d&&(d=function(a){return a}),a||(a=new CSSMatrixDecomposed((new FirminCSSMatrix).decompose()));var e=new CSSMatrixDecomposed,f=index=null,g="";c=d(c);for(index in b)for(f in{x:"x",y:"y",z:"z",w:"w"})e[index][f]=(this[index][f]+(a[index][f]-this[index][f])*c).toFixed(5);g="matrix3d(1,0,0,0, 0,1,0,0, 0,0,1,0, "+e.perspective.x+", "+e.perspective.y+", "+e.perspective.z+", "+e.perspective.w+") "+"translate3d("+e.translate.x+"px, "+e.translate.y+"px, "+e.translate.y+"px) "+"rotateX("+e.rotate.x+"rad) rotateY("+e.rotate.y+"rad) rotateZ("+e.rotate.z+"rad) "+"matrix3d(1,0,0,0, 0,1,0,0, 0,"+e.skew.z+",1,0, 0,0,0,1) "+"matrix3d(1,0,0,0, 0,1,0,0, "+e.skew.y+",0,1,0, 0,0,0,1) "+"matrix3d(1,0,0,0, "+e.skew.x+",1,0,0, 0,0,1,0, 0,0,0,1) "+"scale3d("+e.scale.x+", "+e.scale.y+", "+e.scale.z+")";try{return e=new FirminCSSMatrix(g)}catch(h){return console.error("Invalid matrix string: "+g),""}}},Vector4=function(a,b,c,d){this.x=a?a:0,this.y=b?b:0,this.z=c?c:0,this.w=d?d:0,this.checkValues=function(){this.x=this.x?this.x:0,this.y=this.y?this.y:0,this.z=this.z?this.z:0,this.w=this.w?this.w:0},this.length=function(){return this.checkValues(),Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},this.normalise=function(){var a=this.length(),b=new Vector4(this.x/a,this.y/a,this.z/a);return b},this.dot=function(a){return this.x*a.x+this.y*a.y+this.z*a.z+this.w*a.w},this.cross=function(a){return new Vector4(this.y*a.z-this.z*a.y,this.z*a.x-this.x*a.z,this.x*a.y-this.y*a.x)},this.combine=function(a,b,c){return new Vector4(b*this.x+c*a.x,b*this.y+c*a.y,b*this.z+c*a.z)}};FirminCSSMatrix.prototype.determinant=function(){return this.m14*this.m23*this.m32*this.m41-this.m13*this.m24*this.m32*this.m41-this.m14*this.m22*this.m33*this.m41+this.m12*this.m24*this.m33*this.m41+this.m13*this.m22*this.m34*this.m41-this.m12*this.m23*this.m34*this.m41-this.m14*this.m23*this.m31*this.m42+this.m13*this.m24*this.m31*this.m42+this.m14*this.m21*this.m33*this.m42-this.m11*this.m24*this.m33*this.m42-this.m13*this.m21*this.m34*this.m42+this.m11*this.m23*this.m34*this.m42+this.m14*this.m22*this.m31*this.m43-this.m12*this.m24*this.m31*this.m43-this.m14*this.m21*this.m32*this.m43+this.m11*this.m24*this.m32*this.m43+this.m12*this.m21*this.m34*this.m43-this.m11*this.m22*this.m34*this.m43-this.m13*this.m22*this.m31*this.m44+this.m12*this.m23*this.m31*this.m44+this.m13*this.m21*this.m32*this.m44-this.m11*this.m23*this.m32*this.m44-this.m12*this.m21*this.m33*this.m44+this.m11*this.m22*this.m33*this.m44},FirminCSSMatrix.prototype.decompose=function(){var a=new FirminCSSMatrix(this.toString()),b=rightHandSide=inversePerspectiveMatrix=transposedInversePerspectiveMatrix=perspective=translate=row=i=scale=skew=pdum3=rotate=null;if(0==a.m33)return new CSSMatrixDecomposed((new FirminCSSMatrix).decompose());for(i=1;4>=i;i++)for(j=1;4>=j;j++)a["m"+i+j]/=a.m44;for(b=a,i=1;3>=i;i++)b["m"+i+"4"]=0;if(b.m44=1,0==b.determinant())return new CSSMatrixDecomposed((new FirminCSSMatrix).decompose());for(0!=a.m14||0!=a.m24||0!=a.m34?(rightHandSide=new Vector4(a.m14,a.m24,a.m34,a.m44),inversePerspectiveMatrix=b.inverse(),transposedInversePerspectiveMatrix=inversePerspectiveMatrix.transpose(),perspective=transposedInversePerspectiveMatrix.transformVector(rightHandSide),a.m14=a.m24=a.m34=0,a.m44=1):perspective=new Vector4(0,0,0,1),translate=new Vector4(a.m41,a.m42,a.m43),a.m41=0,a.m42=0,a.m43=0,row=[new Vector4,new Vector4,new Vector4],i=1;3>=i;i++)row[i-1].x=a["m"+i+"1"],row[i-1].y=a["m"+i+"2"],row[i-1].z=a["m"+i+"3"];if(scale=new Vector4,skew=new Vector4,scale.x=row[0].length(),row[0]=row[0].normalise(),skew.x=row[0].dot(row[1]),row[1]=row[1].combine(row[0],1,-skew.x),scale.y=row[1].length(),row[1]=row[1].normalise(),skew.x/=scale.y,skew.y=row[0].dot(row[2]),row[2]=row[2].combine(row[0],1,-skew.y),skew.z=row[1].dot(row[2]),row[2]=row[2].combine(row[1],1,-skew.z),scale.z=row[2].length(),row[2]=row[2].normalise(),skew.y/=scale.z,skew.y/=scale.z,pdum3=row[1].cross(row[2]),row[0].dot(pdum3)<0)for(i=0;3>i;i++)scale.x*=-1,row[i].x*=-1,row[i].y*=-1,row[i].z*=-1;return rotate=new Vector4,rotate.y=Math.asin(-row[0].z),0!=Math.cos(rotate.y)?(rotate.x=Math.atan2(row[1].z,row[2].z),rotate.z=Math.atan2(row[0].y,row[0].x)):(rotate.x=Math.atan2(-row[2].x,row[1].y),rotate.z=0),new CSSMatrixDecomposed({perspective:perspective,translate:translate,skew:skew,scale:scale,rotate:rotate})},function(){function a(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent("on"+b,c)}function b(a){if("keypress"==a.type){var b=String.fromCharCode(a.which);return a.shiftKey||(b=b.toLowerCase())," "==b?"space":b}return n[a.which]?n[a.which]:o[a.which]?o[a.which]:String.fromCharCode(a.which).toLowerCase()}function c(a){a=a||{};var b,c=!1;for(b in t)a[b]?c=!0:t[b]=0;c||(w=!1)}function d(a,b,c,d,e,f){var g,i,j=[],k=c.type;if(!r[a])return[];for("keyup"==k&&h(a)&&(b=[a]),g=0;g<r[a].length;++g)if(i=r[a][g],!(!d&&i.seq&&t[i.seq]!=i.level||k!=i.action||("keypress"!=k||c.metaKey||c.ctrlKey)&&b.sort().join(",")!==i.modifiers.sort().join(","))){var l=d&&i.seq==d&&i.level==f;(!d&&i.combo==e||l)&&r[a].splice(g,1),j.push(i)}return j}function e(a){var b=[];return a.shiftKey&&b.push("shift"),a.altKey&&b.push("alt"),a.ctrlKey&&b.push("ctrl"),a.metaKey&&b.push("meta"),b}function f(a,b,c){y.stopCallback(b,b.target||b.srcElement,c)||!1!==a(b,c)||(b.preventDefault&&b.preventDefault(),b.stopPropagation&&b.stopPropagation(),b.returnValue=!1,b.cancelBubble=!0)}function g(a){"number"!=typeof a.which&&(a.which=a.keyCode);var c=b(a);c&&("keyup"==a.type&&u===c?u=!1:y.handleKey(c,e(a),a))}function h(a){return"shift"==a||"ctrl"==a||"alt"==a||"meta"==a}function i(a,d,e,g){function h(b){return function(){w=b,++t[a],clearTimeout(m),m=setTimeout(c,1e3)}}function i(d){f(e,d,a),"keyup"!==g&&(u=b(d)),setTimeout(c,10)}for(var l=t[a]=0;l<d.length;++l){var n=l+1===d.length?i:h(g||j(d[l+1]).action);k(d[l],n,g,a,l)}}function j(a,b){var c,d,e,f=[];for(c="+"===a?["+"]:a.split("+"),e=0;e<c.length;++e)d=c[e],q[d]&&(d=q[d]),b&&"keypress"!=b&&p[d]&&(d=p[d],f.push("shift")),h(d)&&f.push(d);if(c=d,e=b,!e){if(!l){l={};for(var g in n)g>95&&112>g||n.hasOwnProperty(g)&&(l[n[g]]=g)}e=l[c]?"keydown":"keypress"}return"keypress"==e&&f.length&&(e="keydown"),{key:d,modifiers:f,action:e}}function k(a,b,c,e,f){s[a+":"+c]=b,a=a.replace(/\s+/g," ");var g=a.split(" ");1<g.length?i(a,g,b,c):(c=j(a,c),r[c.key]=r[c.key]||[],d(c.key,c.modifiers,{type:c.action},e,a,f),r[c.key][e?"unshift":"push"]({callback:b,modifiers:c.modifiers,action:c.action,seq:e,level:f,combo:a}))}for(var l,m,n={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},o={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},p={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},q={option:"alt",command:"meta","return":"enter",escape:"esc",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},r={},s={},t={},u=!1,v=!1,w=!1,x=1;20>x;++x)n[111+x]="f"+x;for(x=0;9>=x;++x)n[x+96]=x;a(document,"keypress",g),a(document,"keydown",g),a(document,"keyup",g);var y={bind:function(a,b,c){a=a instanceof Array?a:[a];for(var d=0;d<a.length;++d)k(a[d],b,c);return this},unbind:function(a,b){return y.bind(a,function(){},b)},trigger:function(a,b){return s[a+":"+b]&&s[a+":"+b]({},a),this},reset:function(){return r={},s={},this},stopCallback:function(a,b){return-1<(" "+b.className+" ").indexOf(" mousetrap ")?!1:"INPUT"==b.tagName||"SELECT"==b.tagName||"TEXTAREA"==b.tagName||b.contentEditable&&"true"==b.contentEditable},handleKey:function(a,b,e){var g,i=d(a,b,e);b={};var j=0,k=!1;for(g=0;g<i.length;++g)i[g].seq&&(j=Math.max(j,i[g].level));for(g=0;g<i.length;++g)i[g].seq?i[g].level==j&&(k=!0,b[i[g].seq]=1,f(i[g].callback,e,i[g].combo)):k||f(i[g].callback,e,i[g].combo);i="keypress"==e.type&&v,e.type!=w||h(a)||i||c(b),v=k&&"keydown"==e.type}};window.Mousetrap=y,"function"==typeof define&&define.amd&&define(y)}();var head=document.getElementsByTagName("head")[0],app=document.getElementById("app"),editor=document.getElementById("editor"),scenes=document.getElementsByClassName("scene"),views=document.getElementsByClassName("view"),btnUndo=document.getElementById("btnUndo"),btnRedo=document.getElementById("btnRedo"),mouseDown=!1,mouseMoved=!1,embedURL=window.location.href,settings={name:"Untitled Document",light:"static",shade:".3",tint:".15",border:"0.4",bg:"transparent",snap:"off",match:.5,zoom:100},docState="No changes",currentView="editor",selectedTool="move",gridUnit=16,undo=[],redo=[],createdShapes=0,shapes=[],context=document.getElementById("viewTop"),selection="",press="mousedown",move="mousemove",release="mouseup",ScrollFix=function(a){var b,c;a=a||document.querySelector(a),a&&a.addEventListener("touchstart",function(d){b=d.touches[0].pageY,c=a.scrollTop,0>=c&&(a.scrollTop=1),c+a.offsetHeight>=a.scrollHeight&&(a.scrollTop=a.scrollHeight-a.offsetHeight-1)},!1)};if(checkTouch()){document.body.classList.add("touch"),press="touchstart",move="touchmove",release="touchend";for(var scrollable=document.getElementsByClassName("scrollable"),i=0;i<scrollable.length;i++)new ScrollFix(scrollable[i]),scrollable[i].ontouchmove=function(a){a.stopPropagation()}}else document.body.classList.add("no-touch");for(var AppStatus={startLoading:function(){document.body.classList.add("loading")},stopLoading:function(){document.body.classList.remove("loading")},startLightProcessing:function(){document.body.classList.add("app-light-processing")
},stopLightProcessing:function(){document.body.classList.remove("app-light-processing")}},transitionEnd=whichTransitionEvent(),Models={cuboid:function(){var a={type:"cuboid",x:0,y:0,z:0,w:4,h:5,d:3,rx:0,ry:0,rz:0,cr:0,o:1,colors:!0,cAll:"#FFFFFF",cTp:"",cLt:"",cRt:"",cFt:"",cBk:"",cBm:"",images:!0,iAll:"",iTp:"",iLt:"",iRt:"",iFt:"",iBk:"",iBm:""};return a},cylinder:function(){var a={type:"cylinder",x:0,y:0,z:0,diameter:6,h:5,rx:0,ry:0,rz:0,sides:14,o:1,colors:!0,cAll:"#FFFFFF",cTp:"",cSe:"",cBm:"",images:!0,iAll:"",iTp:"",iSe:"",iBm:""};return a},prism:function(){var a={type:"prism",x:0,y:0,z:0,w:4,h:5,d:3,rx:0,ry:0,rz:0,o:1,colors:!0,cAll:"#FFFFFF",cLt:"",cRt:"",cFt:"",cBk:"",cBm:"",images:!0,iAll:"",iLt:"",iRt:"",iFt:"",iBk:"",iBm:""};return a},pyramid:function(){var a={type:"pyramid",x:0,y:0,z:0,diameter:4,h:5,rx:0,ry:0,rz:0,o:1,colors:!0,cAll:"#FFFFFF",cLt:"",cRt:"",cFt:"",cBk:"",cBm:"",images:!0,iAll:"",iLt:"",iRt:"",iFt:"",iBk:"",iBm:""};return a}},rangeChanging=!1,inputsRange=document.querySelectorAll("[type=range]"),i=0;i<inputsRange.length;i++)inputsRange[i].addEventListener(press,function(){rangeChanging=!0},!1),inputsRange[i].addEventListener(release,function(){rangeChanging=!1;var a=this.getAttribute("data-bind-settings"),b=this.getAttribute("data-bind-selection");null!==a&&rangeSettingsUpdate(a),null!==b&&rangeSelectionUpdate(b)},!1);var HistoryManager={init:function(){this.bindUIActions(),this.updateUI()},bindUIActions:function(){btnUndo.addEventListener(press,function(){HistoryManager.undoAction()},!1),btnRedo.addEventListener(press,function(){HistoryManager.redoAction()},!1)},updateUI:function(){btnUndo.disabled=undo.length>0?!1:!0,btnRedo.disabled=redo.length>0?!1:!0,updateShapeToolsPosition(selection)},undoAction:function(){var a=undo[undo.length-1];if("undefined"!=typeof a){var b=a.actionType,c=JSON.parse(a.shape);if("create"===b&&(redo.push(a),deleteShape(c)),"update"===b){var d=JSON.stringify(getShape(c.id)),e={actionType:"update",shape:d};redo.push(e),updateShape(c)}"delete"===b&&(redo.push(a),createShape(c)),undo.splice(-1,1),HistoryManager.updateUI()}},redoAction:function(){var a=redo[redo.length-1];if("undefined"!=typeof a){var b=a.actionType,c=JSON.parse(a.shape);if("create"===b&&(undo.push(a),createShape(c)),"update"===b){var d=JSON.stringify(getShape(c.id)),e={actionType:"update",shape:d};undo.push(e),updateShape(c)}"delete"===b&&(undo.push(a),deleteShape(c)),redo.splice(-1,1),HistoryManager.updateUI()}}},settingsBinder=new Settings("settings");document.getElementById("shortURL").addEventListener("focus",function(){shortenURL()},!1);var setTexture=function(a,b,c){var d="";return""===c&&""===b?d="":""===b?(d+=a+"{",d+="background-color:"+c+";",d+="}"):(d+=a+"{",d+="background:url("+b+") "+c+";",d+="}"),d},calculateSidesWidth=function(a,b,c){var d=360/parseFloat(c)||1,e=360/(b*d);e*Math.PI/180;var f=2*a*Math.tan(Math.PI/(b*d));return f+=em(.4)},sidesStyles=function(a,b,c,d,e){for(var f="",d=parseFloat(d)||360,g=d/b,e=parseFloat(e)+g/2||g/2,h=0;b>h;h++){var i="s"+h,j=h*g+e,k=c/2-em(.4);f+=a+" ."+i+"{transform: rotateY("+j+"deg) translate3D(-50%,0,"+k+"em); }"}return f},cornerSides=function(a){var b;return a>10&&(b=17),a>5&&10>=a&&(b=11),a>1.5&&5>=a&&(b=5),1.5>=a&&(b=3),b},prismAngle=function(a,b){var c=Math.acos(b/a)*(180/Math.PI),c=Math.acos(b/a)*(180/Math.PI);return c},pythagoras=function(a,b){return Math.sqrt(a*a+b*b)},light=new Photon.Light(x=0,y=0,z=0),scene3D=document.getElementById("scene3D"),lightShapes=[],actionBtns=document.getElementsByClassName("btn-selection"),selectionBinder=new Obj("selection");editor.addEventListener(press,function(a){var b=a.target.classList[0];("wrapper"===b||"shapes"===b)&&deselectShapes()});var grabO,grabH,grabR,handle,handlesR,updatedPos,updatedDim,updatedRot;document.addEventListener(release,dropTool,!1);var isOldOpera=!!window.opera,isOpera=navigator.userAgent.indexOf(" OPR/")>=0,isFirefox="undefined"!=typeof InstallTrigger,isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0,isChrome=!!window.chrome&&!isOpera,isIE=!1||document.documentMode;if(isChrome||isSafari||isOpera)AppStatus.startLoading(),window.addEventListener("load",function(){setTimeout(init,500,!1)});else{document.getElementById("denied").style.display="block";var browserNameSpan=document.getElementById("browserName"),browserName="your web browser";isFirefox&&(browserName="Firefox"),isOldOpera&&(browserName="your version of Opera"),isIE&&(browserName="Internet Explorer"),browserNameSpan.innerHTML=browserName}